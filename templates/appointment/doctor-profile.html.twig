{% extends 'layouts/app.html.twig' %}

{% block title %}Dr. {{ doctor.fullName }} - WellCare Connect{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('appointment') }} 
{% endblock %}

{% block scripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('appointment-booking') }}
{% endblock %}

{% block body %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-900" x-data="doctorProfile()" x-init="init()">
    
    {# Doctor Header Banner #}
    <div class="bg-gradient-to-br from-wellcare-600 to-wellcare-700 dark:from-wellcare-800 dark:to-wellcare-900">
        <div class="py-8 container-wellcare">
            <div class="flex flex-col items-start gap-6 lg:flex-row">
                {# Doctor Photo #}
                <div class="relative flex-shrink-0">
                    <div class="flex items-center justify-center w-32 h-32 bg-white border-4 border-white shadow-xl lg:w-40 lg:h-40 rounded-2xl dark:bg-gray-800 dark:border-gray-700">
                        <i class="text-6xl fas fa-user-md lg:text-7xl text-wellcare-500"></i>
                    </div>
                    <div class="absolute p-2 text-white rounded-full shadow-lg -bottom-2 -right-2 bg-wellcare-500" title="Verified Doctor">
                        <i class="text-lg fas fa-check-circle"></i>
                    </div>
                </div>
                
                {# Doctor Info #}
                <div class="flex-1 text-white">
                    <div class="flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between">
                        <div>
                            <h1 class="text-2xl font-bold lg:text-3xl">Dr. {{ doctor.fullName }}</h1>
                            <p class="mt-1 text-lg text-wellcare-100">{{ doctor.specialite|default('General Medicine') }}</p>
                            
                            <div class="flex flex-wrap items-center gap-4 mt-3">
                                <div class="flex items-center gap-1">
                                    <i class="text-yellow-400 fas fa-star"></i>
                                    <span class="font-semibold">4.5</span>
                                    <span class="text-wellcare-200">(10 reviews)</span>
                                </div>
                                <span class="text-wellcare-200">|</span>
                                <span><i class="mr-1 fas fa-briefcase"></i> {{ doctor.yearsOfExperience|default(0) }} years experience</span>
                                <span class="text-wellcare-200">|</span>
                                <span><i class="mr-1 fas fa-map-marker-alt"></i> {{ doctor.address|default('Tunis') }}</span>
                            </div>
                            
                            <div class="flex flex-wrap gap-2 mt-3">
                                <span class="px-3 py-1 text-sm rounded-full bg-white/20">Arabic</span>
                                <span class="px-3 py-1 text-sm rounded-full bg-white/20">French</span>
                            </div>
                        </div>
                        
                        {# Quick Actions #}
                        <div class="flex flex-col gap-3 lg:text-right">
                            <div class="text-3xl font-bold">{{ doctor.consultationPrice|default(120) }} TND</div>
                            <p class="text-sm text-wellcare-200">per consultation</p>
                            <div class="flex gap-2 lg:justify-end">
                                <button @click="toggleFavorite()" class="p-3 transition-colors bg-white/20 rounded-xl hover:bg-white/30" :class="isFavorite ? 'text-red-400' : 'text-white'">
                                    <i :class="isFavorite ? 'fas fa-heart' : 'far fa-heart'" class="text-xl"></i>
                                </button>
                                <button class="p-3 text-white transition-colors bg-white/20 rounded-xl hover:bg-white/30">
                                    <i class="text-xl fas fa-share-alt"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {# Main Content #}
    <div class="py-8 container-wellcare">
        <div class="flex flex-col gap-8 lg:flex-row">
            
            {# Left Column - Info #}
            <div class="space-y-6 lg:w-2/3">
                
                {# About Section #}
                <div class="card">
                    <div class="p-6">
                        <h2 class="mb-4 text-xl font-semibold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-info-circle text-wellcare-500"></i>About
                        </h2>
                        <p class="leading-relaxed text-gray-600 dark:text-gray-300">
                            {{ doctor.about|default('Dr. ' ~ doctor.fullName ~ ' is a dedicated healthcare professional with ' ~ doctor.yearsOfExperience ~ ' years of experience in ' ~ doctor.specialite|default('General Medicine') ~ '. Committed to providing personalized care and utilizing the latest medical advancements to ensure optimal patient outcomes.') }}
                        </p>
                        
                        <div class="grid grid-cols-1 gap-4 mt-6 sm:grid-cols-2">
                            <div class="flex items-start gap-3">
                                <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                    <i class="fas fa-graduation-cap text-wellcare-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white">Education</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">{{ doctor.education|default('Medical Degree - University of Tunis') }}</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                    <i class="fas fa-certificate text-wellcare-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white">Certifications</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">{{ doctor.certifications|default('Board Certified in ' ~ doctor.specialite|default('Medicine')) }}</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                    <i class="fas fa-hospital text-wellcare-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white">Hospital Affiliations</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">{{ doctor.hospitalAffiliations|default('Local Hospital') }}</p>
                                </div>
                            </div>
                            <div class="flex items-start gap-3">
                                <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                    <i class="fas fa-award text-wellcare-600"></i>
                                </div>
                                <div>
                                    <h4 class="font-medium text-gray-900 dark:text-white">Awards</h4>
                                    <p class="text-sm text-gray-600 dark:text-gray-400">{{ doctor.awards|default('Excellence in Healthcare') }}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                {# Specializations #}
                <div class="card">
                    <div class="p-6">
                        <h2 class="mb-4 text-xl font-semibold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-stethoscope text-wellcare-500"></i>Specializations
                        </h2>
                        <div class="flex flex-wrap gap-2">
                            {% if doctor.specializations %}
                                {% for spec in doctor.specializations %}
                                    <span class="px-4 py-2 text-sm font-medium rounded-lg bg-wellcare-50 dark:bg-wellcare-900/30 text-wellcare-700 dark:text-wellcare-300">{{ spec }}</span>
                                {% endfor %}
                            {% else %}
                                <span class="px-4 py-2 text-sm font-medium rounded-lg bg-wellcare-50 dark:bg-wellcare-900/30 text-wellcare-700 dark:text-wellcare-300">{{ doctor.specialite|default('General Medicine') }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                {# Services & Fees - MODIFIÉ : Supprimé Video Consultation #}
                <div class="card">
                    <div class="p-6">
                        <h2 class="mb-4 text-xl font-semibold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-hand-holding-medical text-wellcare-500"></i>Services & Fees
                        </h2>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
                                <div class="flex items-center gap-3">
                                    <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                        <i class="fas fa-hospital text-wellcare-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 dark:text-white">In-Person Consultation</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">45 minutes at clinic</p>
                                    </div>
                                </div>
                                <span class="text-xl font-bold text-wellcare-600 dark:text-wellcare-400">{{ doctor.consultationPrice|default(120) }} TND</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
                                <div class="flex items-center gap-3">
                                    <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                        <i class="fas fa-phone text-wellcare-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 dark:text-white">Phone Consultation</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">20 minutes call</p>
                                    </div>
                                </div>
                                <span class="text-xl font-bold text-wellcare-600 dark:text-wellcare-400">{{ (doctor.consultationPrice * 0.6)|round|default(70) }} TND</span>
                            </div>
                            
                            <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-800 rounded-xl">
                                <div class="flex items-center gap-3">
                                    <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                        <i class="fas fa-file-medical text-wellcare-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 dark:text-white">Follow-up Visit</h4>
                                        <p class="text-sm text-gray-500 dark:text-gray-400">20 minutes</p>
                                    </div>
                                </div>
                                <span class="text-xl font-bold text-wellcare-600 dark:text-wellcare-400">{{ (doctor.consultationPrice * 0.7)|round|default(80) }} TND</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            {# Right Column - Booking #}
            <div class="lg:w-1/3">
                <div class="sticky space-y-6 top-24">
                    
                    {# Quick Book Card #}
                    <div class="card">
                        <div class="p-6">
                            <h3 class="mb-4 text-lg font-semibold text-gray-900 dark:text-white">Book Appointment</h3>
                            
                            {# Consultation Type - MODIFIÉ : Supprimé Video #}
                            <div class="mb-4">
                                <label class="label">Consultation Type</label>
                                <div class="grid grid-cols-2 gap-2">
                                    <button 
                                        @click="selectedType = 'in-person'"
                                        :class="selectedType === 'in-person' ? 'bg-wellcare-100 border-wellcare-500 text-wellcare-700 dark:bg-wellcare-900 dark:border-wellcare-500 dark:text-wellcare-300' : 'border-gray-200 text-gray-600 dark:border-gray-700 dark:text-gray-400'"
                                        class="p-3 text-center transition-colors border rounded-xl"
                                    >
                                        <i class="block mb-1 fas fa-hospital"></i>
                                        <span class="text-xs">In-Person</span>
                                    </button>
                                    <button 
                                        @click="selectedType = 'phone'"
                                        :class="selectedType === 'phone' ? 'bg-wellcare-100 border-wellcare-500 text-wellcare-700 dark:bg-wellcare-900 dark:border-wellcare-500 dark:text-wellcare-300' : 'border-gray-200 text-gray-600 dark:border-gray-700 dark:text-gray-400'"
                                        class="p-3 text-center transition-colors border rounded-xl"
                                    >
                                        <i class="block mb-1 fas fa-phone"></i>
                                        <span class="text-xs">Phone</span>
                                    </button>
                                </div>
                            </div>
                            
                            {# Date Selection #}
                            <div class="mb-4">
                                <label class="label">Select Date</label>
                                <div class="grid grid-cols-4 gap-2">
                                    <template x-for="(date, index) in availableDates" :key="index">
                                        <button 
                                            @click="selectedDate = date"
                                            :class="selectedDate === date ? 'bg-wellcare-500 text-white' : 'bg-gray-50 text-gray-700 hover:bg-gray-100 dark:bg-gray-800 dark:text-gray-300 dark:hover:bg-gray-700'"
                                            class="p-2 text-center transition-colors rounded-xl"
                                        >
                                            <span class="block text-xs" x-text="date.day"></span>
                                            <span class="block font-semibold" x-text="date.date"></span>
                                        </button>
                                    </template>
                                </div>
                            </div>
                            
                            {# Time Slots #}
                            <div class="mb-6">
                                <label class="label">Available Times</label>
                                <div class="grid grid-cols-3 gap-2">
                                    <template x-for="time in availableTimes" :key="time">
                                        <button 
                                            @click="selectedTime = time"
                                            :class="selectedTime === time ? 'bg-wellcare-500 text-white' : 'border border-gray-200 text-gray-700 hover:border-wellcare-300 dark:border-gray-700 dark:text-gray-300'"
                                            class="px-3 py-2 text-sm transition-colors rounded-lg"
                                            x-text="time"
                                        ></button>
                                    </template>
                                </div>
                            </div>
                            
                            {# Price Summary #}
                            <div class="pt-4 mb-4 border-t border-gray-200 dark:border-gray-700">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-gray-600 dark:text-gray-400">Consultation Fee</span>
                                    <span class="font-medium text-gray-900 dark:text-white" x-text="getPrice() + ' TND'"></span>
                                </div>
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-gray-600 dark:text-gray-400">Platform Fee</span>
                                    <span class="font-medium text-gray-900 dark:text-white">5 TND</span>
                                </div>
                                <div class="flex items-center justify-between pt-2 border-t border-gray-200 dark:border-gray-700">
                                    <span class="font-semibold text-gray-900 dark:text-white">Total</span>
                                    <span class="text-xl font-bold text-wellcare-600 dark:text-wellcare-400" x-text="(getPrice() + 5) + ' TND'"></span>
                                </div>
                            </div>
                            
                            {# CORRIGÉ : Lien vers booking-flow #}
                            <a href="{{ path('appointment_booking_flow') }}?doctorId={{ doctor.id }}" class="block w-full text-center btn-primary">
                                <i class="mr-2 fas fa-calendar-check"></i>Book Now
                            </a>
                            
                            <p class="mt-3 text-xs text-center text-gray-500 dark:text-gray-400">
                                <i class="mr-1 fas fa-shield-alt"></i> Free cancellation up to 24 hours before
                            </p>
                        </div>
                    </div>
                    
                    {# Clinic Info Card #}
                    <div class="card">
                        <div class="p-6">
                            <h3 class="mb-4 text-lg font-semibold text-gray-900 dark:text-white">Clinic Information</h3>
                            
                            <div class="space-y-4">
                                <div class="flex items-start gap-3">
                                    <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                        <i class="fas fa-map-marker-alt text-wellcare-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 dark:text-white">Address</h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ doctor.address|default('Tunis, Tunisia') }}</p>
                                        <a href="#" class="inline-block mt-1 text-sm text-wellcare-600 hover:text-wellcare-700 dark:text-wellcare-400">Get Directions</a>
                                    </div>
                                </div>
                                
                                <div class="flex items-start gap-3">
                                    <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                        <i class="fas fa-clock text-wellcare-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 dark:text-white">Working Hours</h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Mon - Fri: 9:00 AM - 6:00 PM</p>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">Sat: 9:00 AM - 1:00 PM</p>
                                    </div>
                                </div>
                                
                                <div class="flex items-start gap-3">
                                    <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                        <i class="fas fa-phone-alt text-wellcare-600"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-medium text-gray-900 dark:text-white">Contact</h4>
                                        <p class="text-sm text-gray-600 dark:text-gray-400">{{ doctor.phone|default('+216 71 123 456') }}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    {# Insurance Card #}
                    <div class="card">
                        <div class="p-6">
                            <h3 class="mb-4 text-lg font-semibold text-gray-900 dark:text-white">Accepted Insurance</h3>
                            <div class="flex flex-wrap gap-2">
                                <span class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm">CNAM</span>
                                <span class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm">COMAR</span>
                                <span class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm">STAR</span>
                                <span class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm">GAT</span>
                                <span class="px-3 py-1.5 bg-gray-100 dark:bg-gray-800 text-gray-700 dark:text-gray-300 rounded-lg text-sm">BH</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function doctorProfile() {
    return {
        doctorId: '{{ doctor.id }}',
        isFavorite: false,
        selectedType: 'in-person',
        selectedDate: null,
        selectedTime: null,
        
        availableDates: [
            { day: 'Mon', date: '03' },
            { day: 'Tue', date: '04' },
            { day: 'Wed', date: '05' },
            { day: 'Thu', date: '06' }
        ],
        
        availableTimes: [
            '09:00 AM', '10:00 AM', '11:00 AM', 
            '02:00 PM', '03:00 PM', '04:00 PM'
        ],
        
        init() {
            this.selectedDate = this.availableDates[0];
            this.selectedTime = this.availableTimes[0];
            
            const saved = localStorage.getItem('favoriteDoctor_' + this.doctorId);
            if (saved) {
                this.isFavorite = JSON.parse(saved);
            }
        },
        
        toggleFavorite() {
            this.isFavorite = !this.isFavorite;
            localStorage.setItem('favoriteDoctor_' + this.doctorId, JSON.stringify(this.isFavorite));
        },
        
        getPrice() {
            const basePrice = {{ doctor.consultationPrice|default(120) }};
            const prices = {
                'in-person': basePrice,
                'phone': Math.round(basePrice * 0.6)
            };
            return prices[this.selectedType] || basePrice;
        }
    }
}
</script>
{% endblock %}