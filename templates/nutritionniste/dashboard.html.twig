{% extends 'layouts/app.html.twig' %}

{% block title %}Tableau de bord Nutritionniste - WellCare Connect{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('build/nutrition-css.css') }}">
{% endblock %}

{% block body_class %}bg-gray-50 dark:bg-gray-900{% endblock %}

{% block body %}
<div class="min-h-screen py-8" x-data="nutritionnisteDashboard()" x-init="init()">
    <div class="px-4 mx-auto max-w-7xl">
        {# Header #}
        <div class="flex flex-col gap-4 mb-8 lg:flex-row lg:items-center lg:justify-between">
            <div>
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Tableau de bord Nutritionniste</h1>
                <p class="mt-1 text-gray-500 dark:text-gray-400">Gestion complète de vos patients et suivis nutritionnels</p>
            </div>
            <div class="flex items-center gap-3">
                <div class="relative">
                    <input type="text" x-model="globalSearch" placeholder="Rechercher patients, dossiers..."
                           class="w-64 py-2 pl-10 pr-4 border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                    <i class="absolute text-gray-400 transform -translate-y-1/2 fas fa-search left-3 top-1/2"></i>
                </div>
                <button @click="showQuickActions = !showQuickActions" class="p-2 text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>

        {# Quick Stats #}
        <div class="grid grid-cols-1 gap-4 mb-8 md:grid-cols-2 lg:grid-cols-4">
            <div class="p-6 bg-white shadow-lg dark:bg-gray-800 rounded-2xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Patients actifs</p>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="stats.activePatients"></p>
                        <p class="mt-1 text-sm text-green-500"><i class="mr-1 fas fa-arrow-up"></i>+3 ce mois</p>
                    </div>
                    <div class="flex items-center justify-center bg-blue-100 w-14 h-14 rounded-2xl dark:bg-blue-900/30">
                        <i class="text-2xl text-blue-500 fas fa-users"></i>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-white shadow-lg dark:bg-gray-800 rounded-2xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Consultations aujourd'hui</p>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="stats.todayConsultations"></p>
                        <p class="mt-1 text-sm text-gray-500" x-text="stats.pendingConsultations + ' en attente'"></p>
                    </div>
                    <div class="flex items-center justify-center bg-green-100 w-14 h-14 rounded-2xl dark:bg-green-900/30">
                        <i class="text-2xl text-green-500 fas fa-calendar-check"></i>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-white shadow-lg dark:bg-gray-800 rounded-2xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Plans actifs</p>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="stats.activePlans"></p>
                        <p class="mt-1 text-sm text-amber-500" x-text="stats.reviewsPending + ' à revoir'"></p>
                    </div>
                    <div class="flex items-center justify-center w-14 h-14 rounded-2xl bg-amber-100 dark:bg-amber-900/30">
                        <i class="text-2xl fas fa-clipboard-list text-amber-500"></i>
                    </div>
                </div>
            </div>
            <div class="p-6 bg-white shadow-lg dark:bg-gray-800 rounded-2xl">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Messages non lus</p>
                        <p class="text-3xl font-bold text-gray-900 dark:text-white" x-text="stats.unreadMessages"></p>
                        <p class="mt-1 text-sm text-gray-500">2 nécessitant une réponse</p>
                    </div>
                    <div class="flex items-center justify-center bg-purple-100 w-14 h-14 rounded-2xl dark:bg-purple-900/30">
                        <i class="text-2xl text-purple-500 fas fa-envelope"></i>
                    </div>
                </div>
            </div>
        </div>

        {# Main Content Grid #}
        <div class="grid grid-cols-1 gap-6 mb-8 lg:grid-cols-3">
            {# Today's Schedule #}
            <div class="p-6 bg-white shadow-lg lg:col-span-2 dark:bg-gray-800 rounded-2xl">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Programme du jour</h2>
                    <a href="#" class="text-sm font-medium text-wellcare-500 hover:text-wellcare-600">Voir tout</a>
                </div>
                <div class="space-y-4">
                    <template x-for="consultation in todayConsultations" :key="consultation.id">
                        <div class="flex items-center gap-4 p-4 transition-colors cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700/50"
                             @click="viewPatient(consultation.patientId)">
                            <div class="w-16 text-center">
                                <p class="text-sm font-medium text-gray-500" x-text="consultation.time"></p>
                            </div>
                            <div class="w-1 h-12 rounded-full" :class="getConsultationTypeColor(consultation.type)"></div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-gray-900 dark:text-white" x-text="consultation.patientName"></h3>
                                <p class="text-sm text-gray-500" x-text="consultation.type"></p>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="px-3 py-1 text-xs font-medium rounded-full"
                                      :class="consultation.status === 'completed' ? 'bg-green-100 text-green-700' : (consultation.status === 'in-progress' ? 'bg-blue-100 text-blue-700' : 'bg-gray-100 text-gray-700')"
                                      x-text="consultation.statusDisplay"></span>
                                <button class="p-2 text-gray-400 transition-colors hover:text-wellcare-500">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            {# Quick Actions & Messages #}
            <div class="space-y-6">
                {# Quick Actions #}
                <div class="p-6 bg-white shadow-lg dark:bg-gray-800 rounded-2xl">
                    <h2 class="mb-4 text-lg font-bold text-gray-900 dark:text-white">Actions rapides</h2>
                    <div class="grid grid-cols-2 gap-3">
                        <button @click="navigateTo('new-patient')" class="p-4 text-center text-blue-600 transition-colors rounded-xl bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/30">
                            <i class="mb-2 text-xl fas fa-user-plus"></i>
                            <p class="text-sm font-medium">Nouveau patient</p>
                        </button>
                        <button @click="navigateTo('meal-plan')" class="p-4 text-center text-green-600 transition-colors rounded-xl bg-green-50 dark:bg-green-900/20 dark:text-green-400 hover:bg-green-100 dark:hover:bg-green-900/30">
                            <i class="mb-2 text-xl fas fa-utensils"></i>
                            <p class="text-sm font-medium">Créer plan</p>
                        </button>
                        <button @click="navigateTo('analysis')" class="p-4 text-center text-purple-600 transition-colors rounded-xl bg-purple-50 dark:bg-purple-900/20 dark:text-purple-400 hover:bg-purple-100 dark:hover:bg-purple-900/30">
                            <i class="mb-2 text-xl fas fa-chart-pie"></i>
                            <p class="text-sm font-medium">Analyses</p>
                        </button>
                        <button @click="navigateTo('reports')" class="p-4 text-center transition-colors rounded-xl bg-amber-50 dark:bg-amber-900/20 text-amber-600 dark:text-amber-400 hover:bg-amber-100 dark:hover:bg-amber-900/30">
                            <i class="mb-2 text-xl fas fa-file-alt"></i>
                            <p class="text-sm font-medium">Rapports</p>
                        </button>
                    </div>
                </div>

                {# Recent Messages #}
                <div class="p-6 bg-white shadow-lg dark:bg-gray-800 rounded-2xl">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-lg font-bold text-gray-900 dark:text-white">Messages récents</h2>
                        <span class="px-2 py-1 text-xs font-medium text-red-600 bg-red-100 rounded-full" x-text="stats.unreadMessages + ' non lus'"></span>
                    </div>
                    <div class="space-y-3">
                        <template x-for="message in recentMessages" :key="message.id">
                            <div class="flex items-start gap-3 p-3 transition-colors cursor-pointer rounded-xl hover:bg-gray-50 dark:hover:bg-gray-700/50">
                                <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 bg-gray-200 rounded-full dark:bg-gray-600">
                                    <span class="text-sm font-medium text-gray-600 dark:text-gray-300" x-text="message.initials"></span>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex items-center justify-between">
                                        <h4 class="text-sm font-medium text-gray-900 truncate dark:text-white" x-text="message.patientName"></h4>
                                        <span class="text-xs text-gray-400" x-text="message.time"></span>
                                    </div>
                                    <p class="text-sm text-gray-500 truncate" x-text="message.preview"></p>
                                </div>
                                <div x-show="message.unread" class="flex-shrink-0 w-2 h-2 rounded-full bg-wellcare-500"></div>
                            </div>
                        </template>
                    </div>
                    <button class="w-full py-2 mt-4 text-sm font-medium text-gray-700 transition-colors border border-gray-300 rounded-lg dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                        Voir tous les messages
                    </button>
                </div>
            </div>
        </div>

        {# Recent Patients & Activity #}
        <div class="grid grid-cols-1 gap-6 lg:grid-cols-2">
            {# Recent Patients #}
            <div class="p-6 bg-white shadow-lg dark:bg-gray-800 rounded-2xl">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-gray-900 dark:text-white">Patients récents</h2>
                    <a href="#" class="text-sm font-medium text-wellcare-500 hover:text-wellcare-600">Voir tout</a>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <thead>
                            <tr class="text-sm text-left text-gray-500 dark:text-gray-400">
                                <th class="pb-3 font-medium">Patient</th>
                                <th class="pb-3 font-medium">Objectif</th>
                                <th class="pb-3 font-medium">Progression</th>
                                <th class="pb-3 font-medium">Statut</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100 dark:divide-gray-700">
                            <template x-for="patient in recentPatients" :key="patient.id">
                                <tr class="cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700/50" @click="viewPatient(patient.id)">
                                    <td class="py-3">
                                        <div class="flex items-center gap-3">
                                            <div class="flex items-center justify-center w-10 h-10 bg-gray-200 rounded-full dark:bg-gray-600">
                                                <span class="text-sm font-medium text-gray-600 dark:text-gray-300" x-text="patient.initials"></span>
                                            </div>
                                            <div>
                                                <p class="font-medium text-gray-900 dark:text-white" x-text="patient.name"></p>
                                                <p class="text-sm text-gray-500" x-text="patient.age + ' ans'"></p>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="py-3">
                                        <p class="text-sm text-gray-900 dark:text-white" x-text="patient.goal"></p>
                                    </td>
                                    <td class="py-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-20 h-2 overflow-hidden bg-gray-200 rounded-full dark:bg-gray-700">
                                                <div class="h-full rounded-full bg-wellcare-500" :style="'width: ' + patient.progress + '%'"></div>
                                            </div>
                                            <span class="text-xs font-medium text-gray-600 dark:text-gray-400" x-text="patient.progress + '%'"></span>
                                        </div>
                                    </td>
                                    <td class="py-3">
                                        <span class="px-2 py-1 text-xs font-medium rounded-full"
                                              :class="patient.status === 'active' ? 'bg-green-100 text-green-700' : (patient.status === 'pending' ? 'bg-amber-100 text-amber-700' : 'bg-gray-100 text-gray-700')"
                                              x-text="patient.statusDisplay"></span>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>

            {# Activity Feed #}
            <div class="p-6 bg-white shadow-lg dark:bg-gray-800 rounded-2xl">
                <h2 class="mb-6 text-xl font-bold text-gray-900 dark:text-white">Activité récente</h2>
                <div class="space-y-4">
                    <template x-for="activity in activities" :key="activity.id">
                        <div class="flex items-start gap-4">
                            <div class="flex items-center justify-center flex-shrink-0 w-10 h-10 rounded-full"
                                 :class="getActivityIconClass(activity.type)">
                                <i :class="getActivityIcon(activity.type) + ' text-white text-sm'"></i>
                            </div>
                            <div class="flex-1">
                                <p class="text-sm text-gray-900 dark:text-white">
                                    <span class="font-medium" x-text="activity.user"></span>
                                    <span class="text-gray-500" x-text="activity.action"></span>
                                </p>
                                <p class="mt-1 text-xs text-gray-400" x-text="activity.time"></p>
                            </div>
                        </div>
                    </template>
                </div>
                <button class="w-full py-2 mt-4 text-sm font-medium text-gray-700 transition-colors border border-gray-300 rounded-lg dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    Charger plus d'activité
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('build/nutrition.js') }}"></script>
{% endblock %}
