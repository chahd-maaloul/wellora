{% extends 'layouts/app.html.twig' %}

{% block title %}{{ pageTitle }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('coach') }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('coach') }}
{% endblock %}

{% block body %}
<div x-data="reportingTools()" class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 shadow-sm dark:bg-gray-800 dark:border-gray-700">
        <div class="px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="{{ path('coach_dashboard') }}" class="p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="text-gray-600 fas fa-arrow-left dark:text-gray-400"></i>
                    </a>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-chart-report text-wellcare-500"></i>
                            {{ 'Reporting Tools' }}
                        </h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">
                            {{ 'Generate insights and reports' }}
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button @click="generateReport()" class="flex items-center gap-2 px-4 py-2 font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                        <i class="fas fa-file-export"></i>
                        {{ 'Export Report' }}
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="p-6">
        <!-- Quick Stats -->
        <div class="grid grid-cols-1 gap-6 mb-6 md:grid-cols-2 lg:grid-cols-4">
            <div class="p-6 bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ 'Active Clients' }}</p>
                        <p class="mt-1 text-3xl font-bold text-gray-900 dark:text-white">{{ stats.activeClients }}</p>
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 bg-blue-100 rounded-xl dark:bg-blue-900/30">
                        <i class="text-blue-500 fas fa-users"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <span class="text-xs font-medium text-green-500">+{{ stats.newClientsThisMonth }} this month</span>
                </div>
            </div>

            <div class="p-6 bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ 'Sessions This Month' }}</p>
                        <p class="mt-1 text-3xl font-bold text-gray-900 dark:text-white">{{ stats.sessionsThisMonth }}</p>
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 bg-green-100 rounded-xl dark:bg-green-900/30">
                        <i class="text-green-500 fas fa-calendar-check"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <span class="text-xs font-medium text-wellcare-500">{{ stats.completionRate }}% completion rate</span>
                </div>
            </div>

            <div class="p-6 bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ 'Avg Adherence' }}</p>
                        <p class="mt-1 text-3xl font-bold text-gray-900 dark:text-white">{{ stats.avgAdherence }}%</p>
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 bg-purple-100 rounded-xl dark:bg-purple-900/30">
                        <i class="text-purple-500 fas fa-chart-line"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400">Across all clients</span>
                </div>
            </div>

            <div class="p-6 bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm font-medium text-gray-500 dark:text-gray-400">{{ 'Goals Achieved' }}</p>
                        <p class="mt-1 text-3xl font-bold text-gray-900 dark:text-white">{{ stats.goalsAchieved }}</p>
                    </div>
                    <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-amber-100 dark:bg-amber-900/30">
                        <i class="fas fa-trophy text-amber-500"></i>
                    </div>
                </div>
                <div class="mt-3">
                    <span class="text-xs font-medium text-gray-500 dark:text-gray-400">{{ stats.goalsInProgress }} in progress</span>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
            <!-- Report Configuration -->
            <div class="lg:col-span-2">
                <div class="bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-sliders-h text-wellcare-500"></i>
                            {{ 'Report Configuration' }}
                        </h2>
                    </div>
                    <div class="p-6 space-y-6">
                        <!-- Report Type -->
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ 'Report Type' }}</label>
                            <div class="grid grid-cols-2 gap-4">
                                <button 
                                    @click="reportType = 'individual'"
                                    :class="{'ring-2 ring-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20': reportType === 'individual', 'bg-gray-50 dark:bg-gray-700/50': reportType !== 'individual'}"
                                    class="p-4 text-left transition-all border border-gray-200 rounded-lg dark:border-gray-600">
                                    <div class="flex items-center gap-3">
                                        <div class="flex items-center justify-center w-10 h-10 bg-blue-100 rounded-lg dark:bg-blue-900/30">
                                            <i class="text-blue-500 fas fa-user"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900 dark:text-white">{{ 'Individual Client' }}</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Detailed client report' }}</p>
                                        </div>
                                    </div>
                                </button>
                                <button 
                                    @click="reportType = 'cohort'"
                                    :class="{'ring-2 ring-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20': reportType === 'cohort', 'bg-gray-50 dark:bg-gray-700/50': reportType !== 'cohort'}"
                                    class="p-4 text-left transition-all border border-gray-200 rounded-lg dark:border-gray-600">
                                    <div class="flex items-center gap-3">
                                        <div class="flex items-center justify-center w-10 h-10 bg-purple-100 rounded-lg dark:bg-purple-900/30">
                                            <i class="text-purple-500 fas fa-users"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900 dark:text-white">{{ 'Cohort Analysis' }}</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Group performance' }}</p>
                                        </div>
                                    </div>
                                </button>
                                <button 
                                    @click="reportType = 'program'"
                                    :class="{'ring-2 ring-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20': reportType === 'program', 'bg-gray-50 dark:bg-gray-700/50': reportType !== 'program'}"
                                    class="p-4 text-left transition-all border border-gray-200 rounded-lg dark:border-gray-600">
                                    <div class="flex items-center gap-3">
                                        <div class="flex items-center justify-center w-10 h-10 bg-green-100 rounded-lg dark:bg-green-900/30">
                                            <i class="text-green-500 fas fa-dumbbell"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900 dark:text-white">{{ 'Program Effectiveness' }}</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Analyze program results' }}</p>
                                        </div>
                                    </div>
                                </button>
                                <button 
                                    @click="reportType = 'comprehensive'"
                                    :class="{'ring-2 ring-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20': reportType === 'comprehensive', 'bg-gray-50 dark:bg-gray-700/50': reportType !== 'comprehensive'}"
                                    class="p-4 text-left transition-all border border-gray-200 rounded-lg dark:border-gray-600">
                                    <div class="flex items-center gap-3">
                                        <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-amber-100 dark:bg-amber-900/30">
                                            <i class="fas fa-chart-pie text-amber-500"></i>
                                        </div>
                                        <div>
                                            <p class="font-medium text-gray-900 dark:text-white">{{ 'Comprehensive Review' }}</p>
                                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Full practice overview' }}</p>
                                        </div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- Date Range -->
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ 'Start Date' }}</label>
                                <input type="date" x-model="dateRange.start" class="w-full px-4 py-2 text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500">
                            </div>
                            <div>
                                <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ 'End Date' }}</label>
                                <input type="date" x-model="dateRange.end" class="w-full px-4 py-2 text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500">
                            </div>
                        </div>

                        <!-- Client Selection -->
                        <div x-show="reportType === 'individual'">
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ 'Select Client' }}</label>
                            <select x-model="selectedClient" class="w-full px-4 py-2 text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500">
                                <option value="">{{ 'Choose a client...' }}</option>
                                {% for client in clients %}
                                <option value="{{ client.id }}">{{ client.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Metrics Selection -->
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ 'Include Metrics' }}</label>
                            <div class="grid grid-cols-3 gap-3">
                                {% for metric in metrics %}
                                <label class="flex items-center gap-2 p-3 rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700">
                                    <input type="checkbox" x-model="selectedMetrics" value="{{ metric.id }}" class="w-4 h-4 border-gray-300 rounded text-wellcare-500 focus:ring-wellcare-500">
                                    <span class="text-sm text-gray-900 dark:text-white">{{ metric.name }}</span>
                                </label>
                                {% endfor %}
                            </div>
                        </div>

                        <!-- Export Format -->
                        <div>
                            <label class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ 'Export Format' }}</label>
                            <div class="flex gap-3">
                                <button 
                                    @click="exportFormat = 'pdf'"
                                    :class="{'ring-2 ring-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20': exportFormat === 'pdf'}"
                                    class="flex items-center gap-2 px-4 py-2 transition-all border border-gray-200 rounded-lg dark:border-gray-600">
                                    <i class="text-red-500 fas fa-file-pdf"></i>
                                    <span class="text-sm text-gray-900 dark:text-white">PDF</span>
                                </button>
                                <button 
                                    @click="exportFormat = 'excel'"
                                    :class="{'ring-2 ring-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20': exportFormat === 'excel'}"
                                    class="flex items-center gap-2 px-4 py-2 transition-all border border-gray-200 rounded-lg dark:border-gray-600">
                                    <i class="text-green-500 fas fa-file-excel"></i>
                                    <span class="text-sm text-gray-900 dark:text-white">Excel</span>
                                </button>
                                <button 
                                    @click="exportFormat = 'csv'"
                                    :class="{'ring-2 ring-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20': exportFormat === 'csv'}"
                                    class="flex items-center gap-2 px-4 py-2 transition-all border border-gray-200 rounded-lg dark:border-gray-600">
                                    <i class="text-blue-500 fas fa-file-csv"></i>
                                    <span class="text-sm text-gray-900 dark:text-white">CSV</span>
                                </button>
                            </div>
                        </div>

                        <button @click="generateReport()" class="w-full py-3 font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                            <i class="mr-2 fas fa-cog"></i>
                            {{ 'Generate Report' }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Recent Reports & Quick Actions -->
            <div class="space-y-6">
                <!-- Recent Reports -->
                <div class="bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-history text-wellcare-500"></i>
                            {{ 'Recent Reports' }}
                        </h2>
                    </div>
                    <div class="divide-y divide-gray-100 dark:divide-gray-700">
                        {% for report in recentReports %}
                        <div class="flex items-center gap-3 p-4 hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <div class="flex items-center justify-center w-10 h-10 rounded-lg 
                                {% if report.type == 'individual' %}
                                    bg-blue-100 dark:bg-blue-900/30
                                {% elseif report.type == 'cohort' %}
                                    bg-purple-100 dark:bg-purple-900/30
                                {% else %}
                                    bg-green-100 dark:bg-green-900/30
                                {% endif %}
                            ">
                                <i class="fas fa-file-{% if report.type == 'pdf' %}pdf text-red-500{% elseif report.type == 'excel' %}excel text-green-500{% else %}alt text-blue-500{% endif %}"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 truncate dark:text-white">{{ report.name }}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">{{ report.createdAt }} â€¢ {{ report.status }}</p>
                            </div>
                            <button class="p-2 text-gray-400 transition-colors hover:text-wellcare-500">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Scheduled Reports -->
                <div class="bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                                <i class="mr-2 fas fa-clock text-wellcare-500"></i>
                                {{ 'Scheduled Reports' }}
                            </h2>
                            <button class="text-sm font-medium text-wellcare-500 hover:text-wellcare-600">
                                <i class="mr-1 fas fa-plus"></i>{{ 'Add' }}
                            </button>
                        </div>
                    </div>
                    <div class="p-4 space-y-3">
                        {% for schedule in reports %}
                        <div class="flex items-center justify-between p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50">
                            <div>
                                <p class="text-sm font-medium text-gray-900 dark:text-white">{{ schedule.name }}</p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">{{ schedule.createdAt }}</p>
                            </div>
                            <div class="flex items-center gap-2">
                                <span class="px-2 py-1 text-xs font-medium rounded-full 
                                    {% if schedule.status == 'active' %}
                                        bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400
                                    {% else %}
                                        bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400
                                    {% endif %}
                                ">{{ schedule.status }}</span>
                                <button class="p-1 text-gray-400 hover:text-wellcare-500">
                                    <i class="fas fa-ellipsis-v"></i>
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Quick Export -->
                <div class="bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-bolt text-wellcare-500"></i>
                            {{ 'Quick Export' }}
                        </h2>
                    </div>
                    <div class="p-4 space-y-2">
                        <button class="flex items-center justify-between w-full p-3 text-left transition-colors rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <div class="flex items-center gap-3">
                                <div class="flex items-center justify-center w-8 h-8 bg-blue-100 rounded-lg dark:bg-blue-900/30">
                                    <i class="text-blue-500 fas fa-users"></i>
                                </div>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">{{ 'Client Roster' }}</span>
                            </div>
                            <i class="text-gray-400 fas fa-chevron-right"></i>
                        </button>
                        <button class="flex items-center justify-between w-full p-3 text-left transition-colors rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <div class="flex items-center gap-3">
                                <div class="flex items-center justify-center w-8 h-8 bg-green-100 rounded-lg dark:bg-green-900/30">
                                    <i class="text-green-500 fas fa-chart-bar"></i>
                                </div>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">{{ 'Adherence Summary' }}</span>
                            </div>
                            <i class="text-gray-400 fas fa-chevron-right"></i>
                        </button>
                        <button class="flex items-center justify-between w-full p-3 text-left transition-colors rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <div class="flex items-center gap-3">
                                <div class="flex items-center justify-center w-8 h-8 bg-purple-100 rounded-lg dark:bg-purple-900/30">
                                    <i class="text-purple-500 fas fa-trophy"></i>
                                </div>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">{{ 'Milestone Report' }}</span>
                            </div>
                            <i class="text-gray-400 fas fa-chevron-right"></i>
                        </button>
                        <button class="flex items-center justify-between w-full p-3 text-left transition-colors rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <div class="flex items-center gap-3">
                                <div class="flex items-center justify-center w-8 h-8 rounded-lg bg-amber-100 dark:bg-amber-900/30">
                                    <i class="fas fa-dollar-sign text-amber-500"></i>
                                </div>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">{{ 'Revenue Report' }}</span>
                            </div>
                            <i class="text-gray-400 fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
function reportingTools() {
    return {
        reportType: 'individual',
        dateRange: {
            start: new Date().toISOString().split('T')[0],
            end: new Date().toISOString().split('T')[0]
        },
        selectedClient: '',
        selectedMetrics: [],
        exportFormat: 'pdf',
        
        generateReport() {
            console.log('Generating report:', {
                type: this.reportType,
                dateRange: this.dateRange,
                client: this.selectedClient,
                metrics: this.selectedMetrics,
                format: this.exportFormat
            });
        }
    }
}
</script>
{% endblock %}
