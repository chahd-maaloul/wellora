{% extends 'layouts/app.html.twig' %}

{% block title %}{{ pageTitle }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('coach') }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('coach') }}
{% endblock %}

{% block body %}
<div x-data="programDesigner()" class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 shadow-sm dark:bg-gray-800 dark:border-gray-700">
        <div class="px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="{{ path('coach_dashboard') }}" class="p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="text-gray-600 fas fa-arrow-left dark:text-gray-400"></i>
                    </a>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-pencil-ruler text-wellcare-500"></i>
                            {{ 'Program Designer' }}
                        </h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">
                            {{ 'Create and manage workout programs' }}
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <button @click="openExerciseLibrary()" class="flex items-center gap-2 px-4 py-2 font-medium text-gray-700 transition-colors border border-gray-300 rounded-lg dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                        <i class="fas fa-book"></i>
                        {{ 'Exercise Library' }}
                    </button>
                    <button @click="createNewProgram()" class="flex items-center gap-2 px-4 py-2 font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                        <i class="fas fa-plus"></i>
                        {{ 'New Program' }}
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="p-6">
        <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
            <!-- Program Templates -->
            <div class="lg:col-span-2">
                <div class="mb-6">
                    <h2 class="mb-4 text-lg font-semibold text-gray-900 dark:text-white">
                        <i class="mr-2 fas fa-layer-group text-wellcare-500"></i>
                        {{ 'Program Templates' }}
                    </h2>
                    <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                        {% for template in templates %}
                        <div class="transition-shadow bg-white border border-gray-100 shadow-sm cursor-pointer rounded-xl dark:bg-gray-800 dark:border-gray-700 hover:shadow-md" @click="editProgram('{{ template.id }}')">
                            <div class="p-6">
                                <div class="flex items-start justify-between mb-4">
                                    <div class="flex items-center gap-3">
                                        <div class="flex items-center justify-center w-12 h-12 bg-gray-100 rounded-lg dark:bg-gray-700">
                                            <i class="fas {{ template.image }} {{ template.color }} text-xl"></i>
                                        </div>
                                        <div>
                                            <h3 class="font-semibold text-gray-900 dark:text-white">{{ template.name }}</h3>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ template.duration }}</p>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <i class="text-yellow-400 fas fa-star"></i>
                                        <span class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ template.rating }}</span>
                                    </div>
                                </div>
                                <p class="mb-4 text-sm text-gray-600 dark:text-gray-400">{{ template.description }}</p>
                                <div class="flex items-center justify-between">
                                    <div class="flex items-center gap-4">
                                        <span class="px-2 py-1 text-xs font-medium text-blue-600 bg-blue-100 rounded-full dark:bg-blue-900/30 dark:text-blue-400">
                                            {{ template.difficulty }}
                                        </span>
                                        <span class="text-xs text-gray-500 dark:text-gray-400">
                                            <i class="mr-1 fas fa-users"></i>{{ template.clientsUsing }} clients
                                        </span>
                                    </div>
                                    <button class="text-wellcare-500 hover:text-wellcare-600">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        {% endfor %}

                        <!-- Create New Template Card -->
                        <div class="bg-white border-2 border-dashed border-gray-200 rounded-xl dark:border-gray-700 hover:border-wellcare-500 transition-colors cursor-pointer flex items-center justify-center min-h-[200px]" @click="createNewProgram()">
                            <div class="text-center">
                                <div class="flex items-center justify-center w-12 h-12 mx-auto mb-3 rounded-full bg-wellcare-100 dark:bg-wellcare-900/30">
                                    <i class="text-xl fas fa-plus text-wellcare-500"></i>
                                </div>
                                <p class="font-medium text-gray-900 dark:text-white">{{ 'Create New Template' }}</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Build a custom program' }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Program Builder (Hidden by default) -->
                <div x-show="showBuilder" class="bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700" style="display: none;">
                    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <input type="text" x-model="newProgram.name" placeholder="{{ 'Program Name' }}" class="px-4 py-2 text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500">
                                <select x-model="newProgram.difficulty" class="px-4 py-2 text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500">
                                    <option value="beginner">{{ 'Beginner' }}</option>
                                    <option value="intermediate">{{ 'Intermediate' }}</option>
                                    <option value="advanced">{{ 'Advanced' }}</option>
                                </select>
                            </div>
                            <div class="flex items-center gap-2">
                                <button @click="showBuilder = false" class="px-4 py-2 text-gray-700 transition-colors border border-gray-300 rounded-lg dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                                    {{ 'Cancel' }}
                                </button>
                                <button @click="saveProgram()" class="px-4 py-2 font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                                    {{ 'Save Program' }}
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="p-4">
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">{{ 'Program Description' }}</label>
                            <textarea x-model="newProgram.description" rows="2" class="w-full px-4 py-2 text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500" placeholder="Describe the program..."></textarea>
                        </div>
                        
                        <!-- Weekly Schedule -->
                        <div class="mb-4">
                            <label class="block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300">{{ 'Weekly Schedule' }}</label>
                            <div class="grid grid-cols-7 gap-2">
                                <template x-for="(day, index) in ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday']">
                                    <div class="p-3 text-center transition-colors rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700/50 hover:bg-wellcare-100 dark:hover:bg-wellcare-900/30" :class="{'bg-wellcare-100 dark:bg-wellcare-900/30': newProgram.schedule.includes(index)}" @click="toggleDay(index)">
                                        <p class="text-xs font-medium text-gray-700 dark:text-gray-300" x-text="day.substring(0, 3)"></p>
                                    </div>
                                </template>
                            </div>
                        </div>

                        <!-- Exercises List -->
                        <div>
                            <div class="flex items-center justify-between mb-2">
                                <label class="text-sm font-medium text-gray-700 dark:text-gray-300">{{ 'Exercises' }}</label>
                                <button @click="addExercise()" class="text-sm font-medium text-wellcare-500 hover:text-wellcare-600">
                                    <i class="mr-1 fas fa-plus"></i>{{ 'Add Exercise' }}
                                </button>
                            </div>
                            <div class="space-y-2">
                                <template x-for="(exercise, index) in newProgram.exercises" :key="index">
                                    <div class="flex items-center gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50">
                                        <div class="flex items-center justify-center w-8 h-8 rounded bg-wellcare-100 dark:bg-wellcare-900/30">
                                            <i class="fas fa-grip-lines text-wellcare-500"></i>
                                        </div>
                                        <select x-model="exercise.id" class="flex-1 px-3 py-1 text-sm text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                            <option value="">{{ 'Select Exercise' }}</option>
                                            {% for ex in exercises %}
                                            <option value="{{ ex.name }}">{{ ex.name }} ({{ ex.category }})</option>
                                            {% endfor %}
                                        </select>
                                        <input type="text" x-model="exercise.sets" placeholder="{{ 'Sets' }}" class="w-16 px-2 py-1 text-sm text-center text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                        <input type="text" x-model="exercise.reps" placeholder="{{ 'Reps' }}" class="w-16 px-2 py-1 text-sm text-center text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                        <input type="text" x-model="exercise.rest" placeholder="{{ 'Rest' }}" class="w-16 px-2 py-1 text-sm text-center text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                                        <button @click="removeExercise(index)" class="p-1 text-gray-400 hover:text-red-500">
                                            <i class="fas fa-times"></i>
                                        </button>
                                    </div>
                                </template>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Exercise Library Sidebar -->
            <div class="space-y-6">
                <div class="bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
                        <div class="flex items-center justify-between">
                            <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                                <i class="mr-2 fas fa-dumbbell text-wellcare-500"></i>
                                {{ 'Exercise Library' }}
                            </h2>
                        </div>
                        <div class="mt-3">
                            <input 
                                type="text" 
                                x-model="exerciseSearch"
                                placeholder="{{ 'Search exercises...' }}"
                                class="w-full px-4 py-2 text-sm text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500">
                        </div>
                    </div>
                    <div class="p-4 space-y-2 max-h-[600px] overflow-y-auto">
                        {% for exercise in exercises %}
                        <div class="p-3 transition-colors rounded-lg cursor-pointer bg-gray-50 dark:bg-gray-700/50 hover:bg-gray-100 dark:hover:bg-gray-700">
                            <div class="flex items-center justify-between mb-2">
                                <h3 class="font-medium text-gray-900 dark:text-white">{{ exercise.name }}</h3>
                                <span class="px-2 py-1 text-xs font-medium rounded-full 
                                    {% if exercise.difficulty == 'Beginner' %}
                                        bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400
                                    {% elseif exercise.difficulty == 'Intermediate' %}
                                        bg-blue-100 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400
                                    {% else %}
                                        bg-red-100 text-red-600 dark:bg-red-900/30 dark:text-red-400
                                    {% endif %}
                                ">{{ exercise.difficulty }}</span>
                            </div>
                            <div class="flex items-center gap-2 mb-2">
                                <span class="text-xs text-gray-500 dark:text-gray-400">
                                    <i class="mr-1 fas fa-tag"></i>{{ exercise.category }}
                                </span>
                                <span class="text-xs text-gray-500 dark:text-gray-400">
                                    <i class="mr-1 fas fa-tools"></i>{{ exercise.equipment }}
                                </span>
                            </div>
                            <div class="flex flex-wrap gap-1">
                                {% for muscle in exercise.muscles %}
                                <span class="px-2 py-0.5 text-xs rounded bg-wellcare-100 text-wellcare-600 dark:bg-wellcare-900/30 dark:text-wellcare-400">
                                    {{ muscle }}
                                </span>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>

                <!-- Quick Stats -->
                <div class="bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-800 dark:border-gray-700">
                    <div class="p-4 border-b border-gray-100 dark:border-gray-700">
                        <h2 class="text-lg font-semibold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-chart-pie text-wellcare-500"></i>
                            {{ 'Quick Stats' }}
                        </h2>
                    </div>
                    <div class="p-4 space-y-3">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500 dark:text-gray-400">{{ 'Total Templates' }}</span>
                            <span class="font-semibold text-gray-900 dark:text-white">{{ templates|length }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500 dark:text-gray-400">{{ 'Total Exercises' }}</span>
                            <span class="font-semibold text-gray-900 dark:text-white">{{ exercises|length }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-500 dark:text-gray-400">{{ 'Active Clients' }}</span>
                            <span class="font-semibold text-gray-900 dark:text-white">
                                {% set totalClients = 0 %}
                                {% for template in templates %}
                                    {% set totalClients = totalClients + template.clientsUsing %}
                                {% endfor %}
                                {{ totalClients }}
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>
</div>

<script>
function programDesigner() {
    return {
        templates: {{ templates|json_encode|raw }},
        exercises: {{ exercises|json_encode|raw }},
        showBuilder: false,
        exerciseSearch: '',
        newProgram: {
            name: '',
            description: '',
            difficulty: 'intermediate',
            schedule: [],
            exercises: [
                { id: '', sets: '', reps: '', rest: '' }
            ]
        },
        
        createNewProgram() {
            this.showBuilder = true;
            this.newProgram = {
                name: '',
                description: '',
                difficulty: 'intermediate',
                schedule: [],
                exercises: [{ id: '', sets: '', reps: '', rest: '' }]
            };
        },
        
        editProgram(id) {
            console.log('Edit program:', id);
        },
        
        openExerciseLibrary() {
            console.log('Open exercise library');
        },
        
        toggleDay(dayIndex) {
            const index = this.newProgram.schedule.indexOf(dayIndex);
            if (index > -1) {
                this.newProgram.schedule.splice(index, 1);
            } else {
                this.newProgram.schedule.push(dayIndex);
            }
        },
        
        addExercise() {
            this.newProgram.exercises.push({ id: '', sets: '', reps: '', rest: '' });
        },
        
        removeExercise(index) {
            this.newProgram.exercises.splice(index, 1);
        },
        
        saveProgram() {
            console.log('Save program:', this.newProgram);
        }
    }
}
</script>
{% endblock %}
