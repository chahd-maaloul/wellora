<div x-show="showQuickLog" 
     x-cloak
     x-transition:enter="transition ease-out duration-300"
     x-transition:enter-start="opacity-0"
     x-transition:enter-end="opacity-100"
     x-transition:leave="transition ease-in duration-200"
     x-transition:leave-start="opacity-100"
     x-transition:leave-end="opacity-0"
     class="fixed inset-0 z-50 overflow-y-auto" 
     @open-quick-log.window="showQuickLog = true"
     @keydown.escape.window="showQuickLog = false">
    <div class="flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center sm:p-0">
        {# Backdrop #}
        <div x-show="showQuickLog"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0"
             class="fixed inset-0 transition-opacity bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75"
             @click="showQuickLog = false">
        </div>

        {# Modal #}
        <div x-show="showQuickLog"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
             x-transition:enter-end="opacity-100 translate-y-0 sm:scale-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100 translate-y-0 sm:scale-100"
             x-transition:leave-end="opacity-0 translate-y-4 sm:translate-y-0 sm:scale-95"
             class="relative inline-block w-full max-w-lg p-6 my-8 overflow-hidden text-left align-middle transition-all transform bg-white shadow-xl dark:bg-gray-800 rounded-2xl">
            
            {# Header #}
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white">
                    <i class="mr-2 fas fa-search text-wellcare-500"></i>
                    Ajouter un aliment
                </h3>
                <button @click="showQuickLog = false" class="text-gray-400 hover:text-gray-500 dark:hover:text-gray-300">
                    <i class="text-xl fas fa-times"></i>
                </button>
            </div>

            {# Search Input #}
            <div class="relative mb-4">
                <input type="text" 
                       x-model="foodSearch"
                       @input.debounce.300ms="searchFoods()"
                       placeholder="Rechercher un aliment (ex: pomme, poulet, riz...)"
                       class="w-full px-4 py-3 pl-12 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                <i class="absolute text-gray-400 transform -translate-y-1/2 fas fa-search left-4 top-1/2"></i>
            </div>

            {# Quick Add Buttons #}
            <div class="mb-4">
                <p class="mb-2 text-xs font-medium text-gray-500 dark:text-gray-400">Ajout rapide</p>
                <div class="flex flex-wrap gap-2">
                    {% for food in quickAddFoods|default([]) %}
                    <button @click="addQuickFood('{{ food.name }}', {{ food.calories }}, '{{ food.unit|default('pièce') }}')"
                            class="px-3 py-1.5 text-sm bg-gray-100 dark:bg-gray-700 hover:bg-wellcare-100 dark:hover:bg-wellcare-900/30 text-gray-700 dark:text-gray-300 rounded-full transition-colors">
                        {{ food.name }}
                    </button>
                    {% endfor %}
                </div>
            </div>

            {# Search Results #}
            <div x-show="searchResults.length > 0" class="mb-4 overflow-y-auto max-h-60">
                <p class="mb-2 text-xs font-medium text-gray-500 dark:text-gray-400">Résultats de recherche</p>
                <div class="space-y-2">
                    <template x-for="food in searchResults" :key="food.id">
                        <div @click="selectFood(food)"
                             class="flex items-center justify-between p-3 transition-colors rounded-lg cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700">
                            <div class="flex items-center gap-3">
                                <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-wellcare-100 dark:bg-wellcare-900/30">
                                    <i class="fas fa-utensils text-wellcare-500"></i>
                                </div>
                                <div>
                                    <p class="text-sm font-medium text-gray-900 dark:text-white" x-text="food.name"></p>
                                    <p class="text-xs text-gray-500 dark:text-gray-400" x-text="food.brand || 'Générique'"></p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-sm font-medium text-gray-900 dark:text-white" x-text="food.calories + ' kcal'"></p>
                                <p class="text-xs text-gray-500 dark:text-gray-400" x-text="food.portion + ' ' + food.unit"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>

            {# Manual Entry #}
            <div class="pt-4 mt-4 border-t border-gray-200 dark:border-gray-700">
                <p class="mb-3 text-xs font-medium text-gray-500 dark:text-gray-400">
                    <i class="mr-1 fas fa-pen"></i>
                    Saisie manuelle
                </p>
                <div class="grid grid-cols-2 gap-3 mb-3">
                    <div>
                        <label class="block mb-1 text-xs text-gray-500 dark:text-gray-400">Nom</label>
                        <input type="text" x-model="manualFood.name" 
                               class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block mb-1 text-xs text-gray-500 dark:text-gray-400">Calories</label>
                        <input type="number" x-model="manualFood.calories" 
                               class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-3 mb-4">
                    <div>
                        <label class="block mb-1 text-xs text-gray-500 dark:text-gray-400">Protéines (g)</label>
                        <input type="number" x-model="manualFood.proteins" 
                               class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block mb-1 text-xs text-gray-500 dark:text-gray-400">Glucides (g)</label>
                        <input type="number" x-model="manualFood.carbs" 
                               class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </div>
                    <div>
                        <label class="block mb-1 text-xs text-gray-500 dark:text-gray-400">Lipides (g)</label>
                        <input type="number" x-model="manualFood.fats" 
                               class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </div>
                </div>
                <div class="flex items-center gap-3 mb-4">
                    <div class="flex-1">
                        <label class="block mb-1 text-xs text-gray-500 dark:text-gray-400">Repas</label>
                        <select x-model="selectedMeal" 
                                class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                            <option value="breakfast">Petit-déjeuner</option>
                            <option value="lunch">Déjeuner</option>
                            <option value="dinner">Dîner</option>
                            <option value="snacks">Collation</option>
                        </select>
                    </div>
                    <div class="flex-1">
                        <label class="block mb-1 text-xs text-gray-500 dark:text-gray-400">Quantité</label>
                        <input type="number" x-model="manualFood.quantity" value="1" min="1"
                               class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 focus:border-transparent dark:bg-gray-700 dark:text-white">
                    </div>
                </div>
            </div>

            {# Footer #}
            <div class="flex justify-end gap-3 mt-6">
                <button @click="showQuickLog = false"
                        class="px-4 py-2 text-sm font-medium text-gray-700 transition-colors bg-gray-100 rounded-lg dark:text-gray-300 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600">
                    Annuler
                </button>
                <button @click="submitFood()"
                        class="px-4 py-2 text-sm font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                    <i class="mr-1 fas fa-plus"></i>
                    Ajouter
                </button>
            </div>
        </div>
    </div>
</div>
