{#
Quick Log Entry Page
This page provides a dedicated interface for quick food logging with AJAX
#}

{% extends 'layouts/app.html.twig' %}

{% block title %}Ajout Rapide - WellCare Connect{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('nutrition-css') }}
{% endblock %}

{% block body %}
<div class="min-h-screen py-8 bg-gray-50 dark:bg-gray-900">
    <div class="max-w-2xl px-4 mx-auto">
        {# Header #}
        <div class="mb-8 text-center">
            <h1 class="flex items-center justify-center gap-3 text-2xl font-bold text-gray-900 dark:text-white">
                <i class="text-3xl fas fa-plus-circle text-wellcare-500"></i>
                Ajout Rapide d'Aliment
            </h1>
            <p class="mt-2 text-gray-600 dark:text-gray-400">Enregistrez votre repas en quelques secondes</p>
        </div>

        {# Quick Entry Card #}
        <div class="p-6 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
            {# Meal Selection as Links #}
            <div class="mb-6">
                <label class="block mb-3 text-sm font-medium text-gray-700 dark:text-gray-300">Type de repas</label>
                <div class="grid grid-cols-4 gap-3">
                    {% set current_meal = app.request.query.get('meal', 'lunch') %}
                    {% for meal, data in {
                        'breakfast': { icon: 'fa-mug-hot', color: 'orange', label: 'Petit-déj' },
                        'lunch': { icon: 'fa-sun', color: 'yellow', label: 'Déjeuner' },
                        'dinner': { icon: 'fa-moon', color: 'indigo', label: 'Dîner' },
                        'snacks': { icon: 'fa-cookie-bite', color: 'pink', label: 'Collation' }
                    } %}
                    <a href="{{ path('nutrition_quick_log', { meal: meal }) }}"
                       class="flex flex-col items-center p-4 transition-all border-2 rounded-lg text-center
                              {% if current_meal == meal %}border-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20{% else %}border-gray-200 dark:border-gray-700 hover:border-wellcare-300{% endif %}">
                        <i class="fas {{ data.icon }} text-{{ data.color }}-500 text-xl mb-2"></i>
                        <span class="text-xs font-medium text-gray-700 dark:text-gray-300">{{ data.label }}</span>
                    </a>
                    {% endfor %}
                </div>
            </div>

            {# Quick Add Foods with Add and Edit buttons #}
            <div class="mb-6">
                <label class="block mb-3 text-sm font-medium text-gray-700 dark:text-gray-300">Ajout rapide</label>
                <div class="flex flex-wrap gap-2">
                    {% for food in [
                        { name: 'Pomme', calories: 95, protein: 0.5, carbs: 25, fats: 0.3 },
                        { name: 'Banane', calories: 105, protein: 1.3, carbs: 27, fats: 0.4 },
                        { name: 'Oeuf', calories: 78, protein: 6, carbs: 0.6, fats: 5 },
                        { name: 'Yaourt', calories: 120, protein: 8, carbs: 15, fats: 3 },
                        { name: 'Pain', calories: 80, protein: 3, carbs: 15, fats: 1 },
                        { name: 'Lait', calories: 150, protein: 8, carbs: 12, fats: 8 },
                        { name: 'Poulet', calories: 165, protein: 31, carbs: 0, fats: 3.6 },
                        { name: 'Riz', calories: 130, protein: 2.7, carbs: 28, fats: 0.3 }
                    ] %}
                    <div class="flex items-center gap-1 px-2 py-1 bg-gray-100 rounded-lg dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600 group">
                        <a href="{{ path('nutrition_food_add', { 
                            meal: current_meal, 
                            name: food.name, 
                            calories: food.calories,
                            protein: food.protein,
                            carbs: food.carbs,
                            fats: food.fats
                        }) }}"
                           class="flex items-center gap-1 text-sm text-gray-700 dark:text-gray-300 hover:text-wellcare-600">
                            <i class="fas fa-plus-circle text-green-500"></i>
                            <span>{{ food.name }}</span>
                            <span class="text-xs text-gray-500">({{ food.calories }} kcal)</span>
                        </a>
                        <span class="text-gray-300">|</span>
                        <a href="{{ path('nutrition_food_add', { 
                            meal: current_meal, 
                            name: food.name, 
                            calories: food.calories,
                            protein: food.protein,
                            carbs: food.carbs,
                            fats: food.fats,
                            edit: true
                        }) }}"
                           class="text-sm text-blue-500 hover:text-blue-700 dark:hover:text-blue-300" title="Ajouter et modifier">
                            <i class="fas fa-edit"></i>
                        </a>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {# Manual Entry Form with AJAX #}
            <div class="pt-6 mt-6 border-t border-gray-200 dark:border-gray-700">
                <h3 class="mb-4 font-medium text-gray-900 dark:text-white">
                    <i class="mr-2 text-gray-400 fas fa-pen"></i>
                    Saisie manuelle
                </h3>
                
                <form method="post" action="{{ path('nutrition_food_add', { meal: current_meal }) }}" data-ajax="true" data-reset-on-success="true">
                    <div class="space-y-4">
                        <div>
                            <label for="foodName" class="block mb-1 text-sm text-gray-600 dark:text-gray-400">Nom de l'aliment</label>
                            <input type="text" name="foodName" id="foodName" required
                                   class="w-full px-4 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 dark:bg-gray-700 dark:text-white"
                                   value="{{ app.request.query.get('name', '') }}">
                        </div>
                        <div class="grid grid-cols-4 gap-3">
                            <div>
                                <label for="calories" class="block mb-1 text-sm text-gray-600 dark:text-gray-400">Calories</label>
                                <input type="number" name="calories" id="calories" required
                                       class="w-full px-4 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 dark:bg-gray-700 dark:text-white"
                                       value="{{ app.request.query.get('calories', '') }}">
                            </div>
                            <div>
                                <label for="proteins" class="block mb-1 text-sm text-gray-600 dark:text-gray-400">Protéines (g)</label>
                                <input type="number" name="proteins" id="proteins" step="0.1"
                                       class="w-full px-4 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label for="carbs" class="block mb-1 text-sm text-gray-600 dark:text-gray-400">Glucides (g)</label>
                                <input type="number" name="carbs" id="carbs" step="0.1"
                                       class="w-full px-4 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 dark:bg-gray-700 dark:text-white">
                            </div>
                            <div>
                                <label for="fats" class="block mb-1 text-sm text-gray-600 dark:text-gray-400">Lipides (g)</label>
                                <input type="number" name="fats" id="fats" step="0.1"
                                       class="w-full px-4 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                        <div>
                            <label for="quantity" class="block mb-1 text-sm text-gray-600 dark:text-gray-400">Quantité</label>
                            <input type="number" name="quantity" id="quantity" value="1" min="1"
                                   class="w-full px-4 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 focus:ring-2 focus:ring-wellcare-500 dark:bg-gray-700 dark:text-white">
                        </div>
                        <input type="hidden" name="mealType" value="{{ current_meal }}">
                    </div>

                    {# Actions #}
                    <div class="flex gap-3 mt-6">
                        <a href="{{ path('nutrition_dashboard') }}" 
                           class="flex-1 px-4 py-3 text-center text-gray-700 transition-colors bg-gray-100 rounded-lg dark:text-gray-300 dark:bg-gray-700 hover:bg-gray-200 dark:hover:bg-gray-600">
                            Annuler
                        </a>
                        <button type="submit" name="submit_quick_log"
                                class="flex-1 px-4 py-3 text-center text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                            <i class="mr-2 fas fa-plus"></i>
                            Ajouter
                        </button>
                    </div>
                </form>
            </div>
        </div>

        {# Today's Summary #}
        <div class="p-6 mt-6 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
            <h3 class="mb-4 font-medium text-gray-900 dark:text-white">Aujourd'hui</h3>
            <div class="grid grid-cols-4 gap-4 text-center">
                <div>
                    <p class="text-xl font-bold text-wellcare-600" data-calories>{{ calories.consumed|default(0) }}</p>
                    <p class="text-xs text-gray-500">Calories</p>
                </div>
                <div>
                    <p class="text-xl font-bold text-amber-600" data-protein>{{ macros.proteins|default(0) }}g</p>
                    <p class="text-xs text-gray-500">Protéines</p>
                </div>
                <div>
                    <p class="text-xl font-bold text-green-600" data-carbs>{{ macros.carbs|default(0) }}g</p>
                    <p class="text-xs text-gray-500">Glucides</p>
                </div>
                <div>
                    <p class="text-xl font-bold text-purple-600" data-fats>{{ macros.fats|default(0) }}g</p>
                    <p class="text-xs text-gray-500">Lipides</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('build/nutrition-ajax.js') }}"></script>
{% endblock %}
