{% extends 'layouts/app.html.twig' %}

{% block title %}{{ 'Goal Setting - WellCare Connect' | trans }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('fitness-css') }}
{% endblock %}

{% block body %}
<div class="min-h-screen bg-gradient-to-b from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900">
    {# Header avec gradient #}
    <div class="bg-gradient-to-r from-white to-gray-50 shadow-sm dark:from-gray-900 dark:to-gray-800">
        <div class="px-4 py-6 mx-auto max-w-7xl sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="{{ path('fitness_goal_show') }}" class="p-2 transition-all duration-200 text-gray-500 hover:text-gray-700 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-lg group">
                        <svg class="w-6 h-6 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                        </svg>
                    </a>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Create New Goal' | trans }}</h1>
                        <p class="mt-1 text-sm text-gray-600 dark:text-gray-400">{{ 'Step-by-step goal creation' | trans }}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="px-3 py-1 text-sm font-medium text-wellcare-700 bg-wellcare-100 dark:bg-wellcare-900/30 dark:text-wellcare-300 rounded-full">
                        {{ 'Step' | trans }} <span id="current-step-display">1</span>/5
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="px-4 py-6 mx-auto max-w-7xl sm:px-6 lg:px-8">
        {# Symfony Form #}
        {{ form_start(form, {'attr': {'class': 'space-y-6', 'id': 'goal-form', 'novalidate': 'novalidate'}}) }}
        
        {# Afficher les erreurs globales #}
        {% if form.vars.errors|length > 0 %}
        <div class="p-4 mb-6 text-red-700 bg-red-100 border border-red-200 rounded-lg dark:bg-red-900/20 dark:border-red-800 dark:text-red-400 animate-fade-in">
            {{ form_errors(form) }}
        </div>
        {% endif %}
        
        {# Modern Progress Bar with Steps #}
        <div class="mb-12">
            <div class="relative">
                {# Progress Line Background #}
                <div class="absolute left-0 right-0 top-1/2 h-1.5 bg-gradient-to-r from-gray-200 to-gray-200 dark:from-gray-700 dark:to-gray-700 -translate-y-1/2 z-0 rounded-full"></div>
                {# Progress Line Active #}
                <div id="progress-line" class="absolute left-0 top-1/2 h-1.5 bg-gradient-to-r from-wellcare-500 via-wellcare-400 to-wellcare-500 -translate-y-1/2 z-10 rounded-full" style="width: 20%"></div>
                
                {# Steps with improved design #}
                <div class="relative flex justify-between z-20">
                    {% set stepNames = {
                        1: 'Category',
                        2: 'Details', 
                        3: 'Planning',
                        4: 'Coach',
                        5: 'Health',
                        6: 'Review'
                    } %}
                    
                    {% for step in 1..6 %}
                        <div class="flex flex-col items-center">
                           <div id="step-{{ step }}-indicator" 
                                class="w-12 h-12 rounded-full border-4 bg-white dark:bg-gray-900 border-gray-300 dark:border-gray-700 flex items-center justify-center mb-3 transition-all duration-500 ease-out step-indicator relative group {% if step > 1 %}cursor-pointer{% endif %}"
                                {% if step > 1 %}onclick="goToStep({{ step }})"{% endif %}>
                                <span class="text-sm font-medium text-gray-900 dark:text-white">{{ stepNames[step] | trans }}</span>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        {# Step 1: Goal Category Selection #}
        <div id="step-1-content" class="step">
            <div class="p-8 bg-white/80 backdrop-blur-sm dark:bg-gray-900/80 shadow-xl rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Choose Your Goal Category' | trans }}</h2>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">{{ 'Select the primary focus area for your fitness journey' | trans }}</p>
                    </div>
                    <div class="p-3 rounded-lg bg-wellcare-50 dark:bg-wellcare-900/20">
                        <svg class="w-6 h-6 text-wellcare-500 dark:text-wellcare-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3 category-options-grid">
                    {# Weight Management #}
                    <div onclick="selectCategory('weight_loss')" 
                         class="p-6 transition-all duration-300 border-2 rounded-xl cursor-pointer hover:shadow-2xl category-option group relative overflow-hidden"
                         id="category-weight_loss"
                         data-category="weight_loss">
                        <div class="absolute inset-0 bg-gradient-to-br from-blue-50 to-transparent dark:from-blue-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10">
                            <div class="flex items-center justify-center w-14 h-14 mb-4 bg-gradient-to-br from-blue-100 to-blue-50 dark:from-blue-900/30 dark:to-blue-900/10 rounded-2xl group-hover:scale-110 transition-transform duration-300">
                                <svg class="w-7 h-7 text-blue-600 dark:text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"/>
                                </svg>
                            </div>
                            <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white group-hover:text-blue-600 dark:group-hover:text-blue-400 transition-colors duration-300">{{ 'Weight Management' | trans }}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors duration-300">{{ 'Lose, gain, or maintain weight' | trans }}</p>
                        </div>
                    </div>

                    {# Strength Improvement #}
                    <div onclick="selectCategory('strength')" 
                         class="p-6 transition-all duration-300 border-2 rounded-xl cursor-pointer hover:shadow-2xl category-option group relative overflow-hidden"
                         id="category-strength"
                         data-category="strength">
                        <div class="absolute inset-0 bg-gradient-to-br from-purple-50 to-transparent dark:from-purple-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10">
                            <div class="flex items-center justify-center w-14 h-14 mb-4 bg-gradient-to-br from-purple-100 to-purple-50 dark:from-purple-900/30 dark:to-purple-900/10 rounded-2xl group-hover:scale-110 transition-transform duration-300">
                                <svg class="w-7 h-7 text-purple-600 dark:text-purple-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h2m0 0v8m0-8h4m0 0V6m0 2v8m0-8h4m0 0v8m0-8h4m0 0V6m0 2h2m-2 0h4m0 0v8m0-8h4"/>
                                </svg>
                            </div>
                            <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white group-hover:text-purple-600 dark:group-hover:text-purple-400 transition-colors duration-300">{{ 'Strength Building' | trans }}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors duration-300">{{ 'Increase muscle strength and power' | trans }}</p>
                        </div>
                    </div>

                    {# Endurance Enhancement #}
                    <div onclick="selectCategory('endurance')" 
                         class="p-6 transition-all duration-300 border-2 rounded-xl cursor-pointer hover:shadow-2xl category-option group relative overflow-hidden"
                         id="category-endurance"
                         data-category="endurance">
                        <div class="absolute inset-0 bg-gradient-to-br from-green-50 to-transparent dark:from-green-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10">
                            <div class="flex items-center justify-center w-14 h-14 mb-4 bg-gradient-to-br from-green-100 to-green-50 dark:from-green-900/30 dark:to-green-900/10 rounded-2xl group-hover:scale-110 transition-transform duration-300">
                                <svg class="w-7 h-7 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                </svg>
                            </div>
                            <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white group-hover:text-green-600 dark:group-hover:text-green-400 transition-colors duration-300">{{ 'Endurance' | trans }}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors duration-300">{{ 'Improve cardiovascular fitness' | trans }}</p>
                        </div>
                    </div>

                    {# Flexibility #}
                    <div onclick="selectCategory('flexibility')" 
                         class="p-6 transition-all duration-300 border-2 rounded-xl cursor-pointer hover:shadow-2xl category-option group relative overflow-hidden"
                         id="category-flexibility"
                         data-category="flexibility">
                        <div class="absolute inset-0 bg-gradient-to-br from-yellow-50 to-transparent dark:from-yellow-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10">
                            <div class="flex items-center justify-center w-14 h-14 mb-4 bg-gradient-to-br from-yellow-100 to-yellow-50 dark:from-yellow-900/30 dark:to-yellow-900/10 rounded-2xl group-hover:scale-110 transition-transform duration-300">
                                <svg class="w-7 h-7 text-yellow-600 dark:text-yellow-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"/>
                                </svg>
                            </div>
                            <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white group-hover:text-yellow-600 dark:group-hover:text-yellow-400 transition-colors duration-300">{{ 'Flexibility & Mobility' | trans }}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors duration-300">{{ 'Enhance range of motion' | trans }}</p>
                        </div>
                    </div>

                    {# Sport Performance #}
                    <div onclick="selectCategory('sports')" 
                         class="p-6 transition-all duration-300 border-2 rounded-xl cursor-pointer hover:shadow-2xl category-option group relative overflow-hidden"
                         id="category-sports"
                         data-category="sports">
                        <div class="absolute inset-0 bg-gradient-to-br from-red-50 to-transparent dark:from-red-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10">
                            <div class="flex items-center justify-center w-14 h-14 mb-4 bg-gradient-to-br from-red-100 to-red-50 dark:from-red-900/30 dark:to-red-900/10 rounded-2xl group-hover:scale-110 transition-transform duration-300">
                                <svg class="w-7 h-7 text-red-600 dark:text-red-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                </svg>
                            </div>
                            <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white group-hover:text-red-600 dark:group-hover:text-red-400 transition-colors duration-300">{{ 'Sport Performance' | trans }}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors duration-300">{{ 'Athletic performance goals' | trans }}</p>
                        </div>
                    </div>

                    {# Medical Rehabilitation #}
                    <div onclick="selectCategory('rehabilitation')" 
                         class="p-6 transition-all duration-300 border-2 rounded-xl cursor-pointer hover:shadow-2xl category-option group relative overflow-hidden"
                         id="category-rehabilitation"
                         data-category="rehabilitation">
                        <div class="absolute inset-0 bg-gradient-to-br from-teal-50 to-transparent dark:from-teal-900/10 opacity-0 group-hover:opacity-100 transition-opacity duration-300"></div>
                        <div class="relative z-10">
                            <div class="flex items-center justify-center w-14 h-14 mb-4 bg-gradient-to-br from-teal-100 to-teal-50 dark:from-teal-900/30 dark:to-teal-900/10 rounded-2xl group-hover:scale-110 transition-transform duration-300">
                                <svg class="w-7 h-7 text-teal-600 dark:text-teal-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                </svg>
                            </div>
                            <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white group-hover:text-teal-600 dark:group-hover:text-teal-400 transition-colors duration-300">{{ 'Medical Rehab' | trans }}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400 group-hover:text-gray-700 dark:group-hover:text-gray-300 transition-colors duration-300">{{ 'Injury recovery & limitations' | trans }}</p>
                        </div>
                    </div>
                </div>
                
                {# Hidden category field - CORRIGÉ #}
                <div class="hidden">
                    {{ form_widget(form.category, {'attr': {'id': 'goal_category'}}) }}
                </div>
                
                <div class="flex justify-end mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" onclick="nextStep(2)" 
                            class="px-8 py-3.5 text-white transition-all duration-300 rounded-xl bg-gradient-to-r from-wellcare-500 to-wellcare-600 hover:from-wellcare-600 hover:to-wellcare-700 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <span class="font-medium">{{ 'Next Step' | trans }}</span>
                        <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        {# Step 2: Basic Information - CORRIGÉ #}
        <div id="step-2-content" class="step hidden">
            <div class="p-8 bg-white/80 backdrop-blur-sm dark:bg-gray-900/80 shadow-xl rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Basic Information' | trans }}</h2>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">{{ 'Define the foundation of your goal' | trans }}</p>
                    </div>
                    <div class="p-3 rounded-lg bg-wellcare-50 dark:bg-wellcare-900/20">
                        <svg class="w-6 h-6 text-wellcare-500 dark:text-wellcare-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"/>
                        </svg>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Goal Title' | trans }}
                        </label>
                        {{ form_widget(form.title, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500',
                                'placeholder': 'Ex: Perdre 5kg en 3 mois'
                            }
                        }) }}
                        {{ form_errors(form.title) }}
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Description' | trans }}
                        </label>
                        {{ form_widget(form.description, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500 resize-none',
                                'placeholder': 'Décrivez votre objectif en détail...',
                                'rows': '5'
                            }
                        }) }}
                        {{ form_errors(form.description) }}
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Why is this goal important?' | trans }}
                        </label>
                        {{ form_widget(form.relevant, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500 resize-none',
                                'placeholder': 'Ex: Améliorer ma santé, Préparer une compétition, Augmenter ma confiance...',
                                'rows': '4'
                            }
                        }) }}
                        {{ form_errors(form.relevant) }}
                    </div>
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" onclick="prevStep(1)" 
                            class="px-8 py-3.5 text-gray-700 transition-all duration-300 border-2 border-gray-300 rounded-xl dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        <span class="font-medium">{{ 'Back' | trans }}</span>
                    </button>
                    <button type="button" onclick="nextStep(3)" 
                            class="px-8 py-3.5 text-white transition-all duration-300 rounded-xl bg-gradient-to-r from-wellcare-500 to-wellcare-600 hover:from-wellcare-600 hover:to-wellcare-700 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <span class="font-medium">{{ 'Next Step' | trans }}</span>
                        <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        {# Step 3: Planning - CORRIGÉ #}
        <div id="step-3-content" class="step hidden">
            <div class="p-8 bg-white/80 backdrop-blur-sm dark:bg-gray-900/80 shadow-xl rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Planning & Schedule' | trans }}</h2>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">{{ 'Define your goal timeline and schedule' | trans }}</p>
                    </div>
                    <div class="p-3 rounded-lg bg-wellcare-50 dark:bg-wellcare-900/20">
                        <svg class="w-6 h-6 text-wellcare-500 dark:text-wellcare-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="space-y-8">
                    <div id="target-fields" class="grid grid-cols-1 gap-6 md:grid-cols-3">
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Target Value' | trans }}
                            </label>
                            {{ form_widget(form.targetValue, {
                                'attr': {
                                    'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500',
                                    'placeholder': 'Ex: 5'
                                }
                            }) }}
                            {{ form_errors(form.targetValue) }}
                        </div>
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Current Value' | trans }}
                            </label>
                            {{ form_widget(form.currentValue, {
                                'attr': {
                                    'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500',
                                    'placeholder': 'Ex: 0'
                                }
                            }) }}
                            {{ form_errors(form.currentValue) }}
                        </div>
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Unit' | trans }}
                            </label>
                            {{ form_widget(form.unit, {
                                'attr': {
                                    'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500 cursor-pointer'
                                }
                            }) }}
                            {{ form_errors(form.unit) }}
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Start Date' | trans }}
                            </label>
                            <div class="relative">
                                {{ form_widget(form.startDate, {
                                    'attr': {
                                        'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500',
                                        'onchange': 'calculateDurationWeeks()'
                                    }
                                }) }}
                                <svg class="absolute right-4 top-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            {{ form_errors(form.startDate) }}
                        </div>
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'End Date' | trans }}
                            </label>
                            <div class="relative">
                                {{ form_widget(form.endDate, {
                                    'attr': {
                                        'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500',
                                        'onchange': 'calculateDurationWeeks()'
                                    }
                                }) }}
                                <svg class="absolute right-4 top-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                </svg>
                            </div>
                            {{ form_errors(form.endDate) }}
                        </div>
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Duration (weeks)' | trans }}
                        </label>
                        {{ form_widget(form.durationWeeks, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500 bg-gray-100 dark:bg-gray-700',
                                'readonly': true
                            }
                        }) }}
                        {{ form_errors(form.durationWeeks) }}
                        <p id="duration-message" class="mt-2 text-xs text-gray-500 dark:text-gray-400 hidden">
                            {{ 'Calculated based on selected dates' | trans }}
                        </p>
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Frequency' | trans }}
                        </label>
                        {{ form_widget(form.frequency, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500 cursor-pointer'
                            }
                        }) }}
                        {{ form_errors(form.frequency) }}
                    </div>
                    
                    <div class="grid grid-cols-1 gap-6 md:grid-cols-2">
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Sessions Per Week' | trans }}
                            </label>
                            {{ form_widget(form.sessionsPerWeek, {
                                'attr': {
                                    'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500'
                                }
                            }) }}
                            {{ form_errors(form.sessionsPerWeek) }}
                        </div>
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Session Duration (minutes)' | trans }}
                            </label>
                            {{ form_widget(form.sessionDuration, {
                                'attr': {
                                    'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500'
                                }
                            }) }}
                            {{ form_errors(form.sessionDuration) }}
                        </div>
                    </div>
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" onclick="prevStep(2)" 
                            class="px-8 py-3.5 text-gray-700 transition-all duration-300 border-2 border-gray-300 rounded-xl dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        <span class="font-medium">{{ 'Back' | trans }}</span>
                    </button>
                    <button type="button" onclick="nextStep(4)" 
                            class="px-8 py-3.5 text-white transition-all duration-300 rounded-xl bg-gradient-to-r from-wellcare-500 to-wellcare-600 hover:from-wellcare-600 hover:to-wellcare-700 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <span class="font-medium">{{ 'Next Step' | trans }}</span>
                        <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        {# Step 4: Coach Selection - CORRIGÉ #}
        <div id="step-4-content" class="step hidden">
            <div class="p-8 bg-white/80 backdrop-blur-sm dark:bg-gray-900/80 shadow-xl rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Choose Your Coach' | trans }}</h2>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">{{ 'Select a coach to guide you through your fitness journey' | trans }}</p>
                    </div>
                    <div class="p-3 rounded-lg bg-wellcare-50 dark:bg-wellcare-900/20">
                        <svg class="w-6 h-6 text-wellcare-500 dark:text-wellcare-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="space-y-6">
                    <div class="relative mb-6">
                        <input type="text" 
                               id="coach-search" 
                               placeholder="{{ 'Rechercher un coach...' | trans }}"
                               class="w-full px-5 py-4 pl-12 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300">
                        <svg class="absolute left-4 top-4 w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                    
                    <div class="hidden">
                        {{ form_widget(form.coachId, {'attr': {'class': 'coach-select', 'id': 'goal_coachId'}}) }}
                    </div>
                    
                    <div id="coach-cards-container" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        {% if coaches is defined and coaches|length > 0 %}
                            {% for coach in coaches %}
                                <div onclick="selectCoach('{{ coach.uuid }}')" 
                                     class="p-4 transition-all duration-300 border-2 border-gray-200 dark:border-gray-700 rounded-xl cursor-pointer hover:shadow-2xl coach-card group"
                                     data-coach-id="{{ coach.uuid }}"
                                     data-coach-name="{{ coach.firstName }} {{ coach.lastName }}"
                                     data-coach-email="{{ coach.email }}">
                                    <div class="flex items-center space-x-4">
                                        <div class="flex-shrink-0">
                                            <div class="w-12 h-12 bg-gradient-to-br from-wellcare-100 to-wellcare-50 dark:from-wellcare-900/30 dark:to-wellcare-900/10 rounded-full flex items-center justify-center">
                                                <span class="text-lg font-semibold text-wellcare-600 dark:text-wellcare-400">
                                                    {{ coach.firstName|first }}{{ coach.lastName|first }}
                                                </span>
                                            </div>
                                        </div>
                                        <div class="flex-1">
                                            <h3 class="font-semibold text-gray-900 dark:text-white">{{ coach.firstName }} {{ coach.lastName }}</h3>
                                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ coach.email }}</p>
                                            {% if coach.specialization is defined %}
                                                <p class="text-xs text-wellcare-500 mt-1">{{ coach.specialization }}</p>
                                            {% endif %}
                                        </div>
                                        <div class="flex-shrink-0">
                                            <div class="w-6 h-6 rounded-full border-2 border-gray-300 dark:border-gray-600 coach-check hidden">
                                                <svg class="w-4 h-4 text-wellcare-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                                </svg>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {% endfor %}
                        {% else %}
                            <div class="col-span-2 p-8 text-center text-gray-500 dark:text-gray-400">
                                {{ 'Aucun coach disponible pour le moment' | trans }}
                            </div>
                        {% endif %}
                        
                        <div onclick="selectCoach('')" 
                             class="p-4 transition-all duration-300 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl cursor-pointer hover:shadow-lg coach-card group"
                             data-coach-id="">
                            <div class="flex items-center justify-center space-x-2">
                                <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                                </svg>
                                <span class="text-gray-600 dark:text-gray-400">{{ 'Continuer sans coach' | trans }}</span>
                            </div>
                        </div>
                    </div>
                    
                    <p class="text-sm text-gray-500 dark:text-gray-400 mt-4">
                        {{ 'Vous pouvez également choisir de ne pas sélectionner de coach pour le moment.' | trans }}
                    </p>
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" onclick="prevStep(3)" 
                            class="px-8 py-3.5 text-gray-700 transition-all duration-300 border-2 border-gray-300 rounded-xl dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        <span class="font-medium">{{ 'Back' | trans }}</span>
                    </button>
                    <button type="button" onclick="nextStep(5)" 
                            class="px-8 py-3.5 text-white transition-all duration-300 rounded-xl bg-gradient-to-r from-wellcare-500 to-wellcare-600 hover:from-wellcare-600 hover:to-wellcare-700 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <span class="font-medium">{{ 'Next Step' | trans }}</span>
                        <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        {# Step 5: Health & Metrics - CORRIGÉ #}
        <div id="step-5-content" class="step hidden">
            <div class="p-8 bg-white/80 backdrop-blur-sm dark:bg-gray-900/80 shadow-xl rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Health & Metrics' | trans }}</h2>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">{{ 'Personalize your goal based on health metrics' | trans }}</p>
                    </div>
                    <div class="p-3 rounded-lg bg-wellcare-50 dark:bg-wellcare-900/20">
                        <svg class="w-6 h-6 text-wellcare-500 dark:text-wellcare-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="space-y-8">
                    <div class="grid grid-cols-1 gap-6 md:grid-cols-3">
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Starting Weight (kg)' | trans }}
                            </label>
                            {{ form_widget(form.weightStart, {
                                'attr': {
                                    'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500'
                                }
                            }) }}
                            {{ form_errors(form.weightStart) }}
                        </div>
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Target Weight (kg)' | trans }}
                            </label>
                            {{ form_widget(form.weightTarget, {
                                'attr': {
                                    'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500'
                                }
                            }) }}
                            {{ form_errors(form.weightTarget) }}
                        </div>
                        <div class="group">
                            <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                                {{ 'Height (cm)' | trans }}
                            </label>
                            {{ form_widget(form.height, {
                                'attr': {
                                    'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500'
                                }
                            }) }}
                            {{ form_errors(form.height) }}
                        </div>
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Daily Calories Target' | trans }}
                        </label>
                        {{ form_widget(form.caloriesTarget, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500'
                            }
                        }) }}
                        {{ form_errors(form.caloriesTarget) }}
                    </div>
                    
                    <div class="hidden">
                        {{ form_widget(form.goalType) }}
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Initial Progress (%)' | trans }}
                        </label>
                        <div class="relative">
                            {{ form_widget(form.progress, {
                                'attr': {
                                    'class': 'w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer progress-slider',
                                    'min': '0', 
                                    'max': '100', 
                                    'value': '0',
                                    'oninput': 'updateProgressValue(this.value)'
                                }
                            }) }}
                            <div class="flex justify-between mt-2">
                                <span class="text-xs text-gray-500">0%</span>
                                <span id="progress-value" class="text-sm font-medium text-wellcare-600 dark:text-wellcare-400">0%</span>
                                <span class="text-xs text-gray-500">100%</span>
                            </div>
                        </div>
                        {{ form_errors(form.progress) }}
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Difficulty Level' | trans }}
                        </label>
                        {{ form_widget(form.difficultyLevel, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500 cursor-pointer',
                                'onchange': 'updateDifficultyIndicator(this.value)'
                            }
                        }) }}
                        {{ form_errors(form.difficultyLevel) }}
                        <div id="difficulty-indicator" class="flex mt-3 space-x-2">
                            <div class="flex-1 h-2 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                            <div class="flex-1 h-2 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                            <div class="flex-1 h-2 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                            <div class="flex-1 h-2 rounded-full bg-gray-200 dark:bg-gray-700"></div>
                        </div>
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Target Audience' | trans }}
                        </label>
                        {{ form_widget(form.targetAudience, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500 cursor-pointer'
                            }
                        }) }}
                        {{ form_errors(form.targetAudience) }}
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Rest Days' | trans }}
                        </label>
                        {{ form_widget(form.restDays, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500'
                            }
                        }) }}
                        {{ form_errors(form.restDays) }}
                    </div>
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" onclick="prevStep(4)" 
                            class="px-8 py-3.5 text-gray-700 transition-all duration-300 border-2 border-gray-300 rounded-xl dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        <span class="font-medium">{{ 'Back' | trans }}</span>
                    </button>
                    <button type="button" onclick="nextStep(6)" 
                            class="px-8 py-3.5 text-white transition-all duration-300 rounded-xl bg-gradient-to-r from-wellcare-500 to-wellcare-600 hover:from-wellcare-600 hover:to-wellcare-700 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <span class="font-medium">{{ 'Next Step' | trans }}</span>
                        <svg class="w-5 h-5 transition-transform group-hover:translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        {# Step 6: Review & Commitment - CORRIGÉ #}
        <div id="step-6-content" class="step hidden">
            <div class="p-8 bg-white/80 backdrop-blur-sm dark:bg-gray-900/80 shadow-xl rounded-2xl border border-gray-200/50 dark:border-gray-700/50">
                <div class="flex items-center justify-between mb-8">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Review & Commitment' | trans }}</h2>
                        <p class="mt-2 text-gray-600 dark:text-gray-400">{{ 'Review your goal and commit to success' | trans }}</p>
                    </div>
                    <div class="p-3 rounded-lg bg-wellcare-50 dark:bg-wellcare-900/20">
                        <svg class="w-6 h-6 text-wellcare-500 dark:text-wellcare-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                    </div>
                </div>
                
                <div class="space-y-8">
                    <div class="p-6 border-2 border-gray-200 dark:border-gray-700 rounded-xl bg-gradient-to-br from-gray-50 to-white dark:from-gray-800 dark:to-gray-900">
                        <h3 class="mb-4 text-lg font-semibold text-gray-900 dark:text-white">{{ 'Goal Summary' | trans }}</h3>
                        <div class="grid grid-cols-1 gap-4 md:grid-cols-2">
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Category' | trans }}</p>
                                <p id="summary-category" class="font-medium text-gray-900 dark:text-white">-</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Title' | trans }}</p>
                                <p id="summary-title" class="font-medium text-gray-900 dark:text-white">-</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Duration' | trans }}</p>
                                <p id="summary-duration" class="font-medium text-gray-900 dark:text-white">- weeks</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Frequency' | trans }}</p>
                                <p id="summary-frequency" class="font-medium text-gray-900 dark:text-white">- sessions/week</p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Coach' | trans }}</p>
                                <p id="summary-coach" class="font-medium text-gray-900 dark:text-white">-</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="p-6 border-2 border-gray-200 dark:border-gray-700 rounded-xl hover:border-wellcare-300 dark:hover:border-wellcare-700 transition-all duration-300 group/commitment">
                        <label class="flex items-center cursor-pointer">
                            <div class="relative">
                                {{ form_widget(form.userCommitment, {
                                    'attr': {
                                        'class': 'sr-only peer',
                                        'id': 'commitment-checkbox'
                                    }
                                }) }}
                                <div class="w-6 h-6 border-2 border-gray-300 dark:border-gray-600 rounded-lg peer-checked:border-wellcare-500 peer-checked:bg-wellcare-500 transition-all duration-200 flex items-center justify-center group-hover/commitment:border-gray-400 dark:group-hover/commitment:border-gray-500">
                                    <svg class="w-4 h-4 text-white opacity-0 peer-checked:opacity-100 transition-opacity duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 13l4 4L19 7"/>
                                    </svg>
                                </div>
                            </div>
                            <span class="ml-4 text-base font-medium text-gray-900 dark:text-white group-hover/commitment:text-gray-950 dark:group-hover/commitment:text-gray-100 transition-colors duration-300">
                                {{ 'I commit to following this goal and understand the importance of consistency in achieving results.' | trans }}
                            </span>
                        </label>
                        {{ form_errors(form.userCommitment) }}
                    </div>
                    
                    <div class="group">
                        <label class="block mb-3 text-sm font-semibold text-gray-700 dark:text-gray-300">
                            {{ 'Preferred Time' | trans }}
                        </label>
                        {{ form_widget(form.preferredTime, {
                            'attr': {
                                'class': 'w-full px-5 py-4 border-2 border-gray-300 rounded-xl dark:border-gray-600 focus:ring-3 focus:ring-wellcare-500/20 focus:border-wellcare-500 dark:bg-gray-800/50 dark:text-white transition-all duration-300 hover:border-gray-400 dark:hover:border-gray-500 cursor-pointer'
                            }
                        }) }}
                        {{ form_errors(form.preferredTime) }}
                    </div>
                </div>
                
                <div class="hidden">
                    {{ form_widget(form.status) }}
                    {{ form_widget(form.date) }}
                </div>
                
                <div class="flex justify-between mt-8 pt-6 border-t border-gray-200 dark:border-gray-700">
                    <button type="button" onclick="prevStep(5)" 
                            class="px-8 py-3.5 text-gray-700 transition-all duration-300 border-2 border-gray-300 rounded-xl dark:border-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800 hover:shadow-lg transform hover:-translate-y-0.5 flex items-center gap-3 group">
                        <svg class="w-5 h-5 transition-transform group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                        <span class="font-medium">{{ 'Back' | trans }}</span>
                    </button>
                    <button type="submit" 
                            id="submit-button"
                            class="px-8 py-3.5 text-white transition-all duration-300 rounded-xl bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 hover:shadow-lg transform hover:-translate-y-0.5 hover:scale-105 flex items-center gap-3 group relative overflow-hidden">
                        <span class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent translate-x-[-100%] group-hover:translate-x-[100%] transition-transform duration-1000"></span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        <span class="font-medium relative z-10">{{ 'Create Goal' | trans }}</span>
                    </button>
                </div>
            </div>
        </div>
        
        {{ form_end(form) }}
    </div>
</div>

{# Success Toast Template #}
<div id="success-toast" class="fixed bottom-4 right-4 p-4 bg-green-500 text-white rounded-xl shadow-2xl transform translate-y-full opacity-0 transition-all duration-500 z-50 max-w-sm hidden">
    <div class="flex items-center gap-3">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
        </svg>
        <div>
            <p class="font-semibold">{{ 'Goal Created!' | trans }}</p>
            <p class="text-sm opacity-90">{{ 'Your goal has been successfully created.' | trans }}</p>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('fitness') }}
    <script>
        // Configuration globale
        let currentStep = 1;
        const totalSteps = 6;
        let isTransitioning = false;
        let selectedCategory = null;

        // Éléments DOM
        const progressLine = document.getElementById('progress-line');
        const currentStepDisplay = document.getElementById('current-step-display');
        const submitButton = document.getElementById('submit-button');
        const successToast = document.getElementById('success-toast');
        const targetFields = document.getElementById('target-fields');
        
        // Fonction pour sélectionner un coach
        function selectCoach(coachId) {
            const coachField = document.getElementById('goal_coachId');
            if (coachField) {
                coachField.value = coachId || '';
                coachField.dispatchEvent(new Event('change', { bubbles: true }));
            }
            
            document.querySelectorAll('.coach-card').forEach(card => {
                const checkIcon = card.querySelector('.coach-check');
                if (card.dataset.coachId === coachId) {
                    card.classList.add('border-wellcare-500', 'bg-wellcare-50', 'dark:bg-wellcare-900/20');
                    card.classList.remove('border-gray-200', 'dark:border-gray-700');
                    if (checkIcon) {
                        checkIcon.classList.remove('hidden');
                        checkIcon.classList.add('flex');
                    }
                } else {
                    card.classList.remove('border-wellcare-500', 'bg-wellcare-50', 'dark:bg-wellcare-900/20');
                    card.classList.add('border-gray-200', 'dark:border-gray-700');
                    if (checkIcon) {
                        checkIcon.classList.add('hidden');
                        checkIcon.classList.remove('flex');
                    }
                }
            });
        }

        // Fonction de recherche
        function setupCoachSearch() {
            const searchInput = document.getElementById('coach-search');
            if (!searchInput) return;
            
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const cards = document.querySelectorAll('.coach-card[data-coach-id!=""]');
                
                cards.forEach(card => {
                    const coachName = card.dataset.coachName?.toLowerCase() || '';
                    const coachEmail = card.dataset.coachEmail?.toLowerCase() || '';
                    
                    if (coachName.includes(searchTerm) || coachEmail.includes(searchTerm) || searchTerm === '') {
                        card.style.display = 'block';
                        setTimeout(() => {
                            card.style.opacity = '1';
                            card.style.transform = 'scale(1)';
                        }, 50);
                    } else {
                        card.style.opacity = '0';
                        card.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            card.style.display = 'none';
                        }, 300);
                    }
                });
            });
        }

        // Fonction pour naviguer vers une étape spécifique
        function goToStep(targetStep) {
            if (targetStep < 1 || targetStep > totalSteps || targetStep > currentStep) return;
            if (targetStep < currentStep) {
                prevStep(targetStep);
            }
        }

        // Animation de transition entre les étapes
        async function transitionStep(fromStep, toStep, direction = 'forward') {
            if (isTransitioning) return;
            
            isTransitioning = true;
            const currentContent = document.getElementById(`step-${fromStep}-content`);
            const nextContent = document.getElementById(`step-${toStep}-content`);
            
            if (currentContent) {
                currentContent.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                currentContent.style.opacity = '0';
                currentContent.style.transform = direction === 'forward' 
                    ? 'translateX(-100px) scale(0.95)' 
                    : 'translateX(100px) scale(0.95)';
                
                await new Promise(resolve => setTimeout(resolve, 300));
                currentContent.classList.add('hidden');
            }
            
            currentStepDisplay.textContent = toStep;
            currentStepDisplay.style.transform = 'scale(1.2)';
            setTimeout(() => {
                currentStepDisplay.style.transform = 'scale(1)';
            }, 300);
            
            updateProgressBar(toStep);
            
            if (nextContent) {
                nextContent.classList.remove('hidden');
                nextContent.style.opacity = '0';
                nextContent.style.transform = direction === 'forward' 
                    ? 'translateX(100px) scale(0.95)' 
                    : 'translateX(-100px) scale(0.95)';
                
                await new Promise(resolve => requestAnimationFrame(resolve));
                
                nextContent.style.transition = 'all 0.5s cubic-bezier(0.4, 0, 0.2, 1)';
                nextContent.style.opacity = '1';
                nextContent.style.transform = 'translateX(0) scale(1)';
                
                window.scrollTo({ top: 0, behavior: 'smooth' });
                
                await new Promise(resolve => setTimeout(resolve, 500));
            }
            
            isTransitioning = false;
            currentStep = toStep;
            
            if (toStep === 6) {
                updateSummary();
            }
            if (toStep === 4) {
                setupCoachSearch();
            }
        }

        // Mettre à jour la barre de progression
        function updateProgressBar(step) {
            const progressPercentage = ((step - 1) / (totalSteps - 1)) * 100;
            if (progressLine) {
                progressLine.style.transition = 'width 0.8s cubic-bezier(0.34, 1.56, 0.64, 1)';
                progressLine.style.width = `${progressPercentage}%`;
            }
            updateStepIndicators(step);
        }

        // Mettre à jour les indicateurs d'étape
        function updateStepIndicators(step) {
            for (let i = 1; i <= totalSteps; i++) {
                const indicator = document.getElementById(`step-${i}-indicator`);
                if (!indicator) continue;
                
                if (i < step) {
                    indicator.classList.add('completed');
                    indicator.style.borderColor = '#4f46e5';
                    indicator.style.backgroundColor = '#4f46e5';
                } else if (i === step) {
                    indicator.classList.add('active');
                    indicator.style.borderColor = '#4f46e5';
                    indicator.style.backgroundColor = window.matchMedia('(prefers-color-scheme: dark)').matches 
                        ? '#1f2937' 
                        : '#ffffff';
                } else {
                    indicator.classList.add('upcoming');
                    indicator.style.borderColor = '#d1d5db';
                    indicator.style.backgroundColor = window.matchMedia('(prefers-color-scheme: dark)').matches 
                        ? '#1f2937' 
                        : '#ffffff';
                }
            }
        }

        async function nextStep(targetStep) {
            await transitionStep(currentStep, targetStep, 'forward');
        }

        async function prevStep(targetStep) {
            await transitionStep(currentStep, targetStep, 'backward');
        }

        function selectCategory(category) {
            if (selectedCategory === category) return;
            
            selectedCategory = category;
            
            document.querySelectorAll('.category-option').forEach((el) => {
                if (el.id !== `category-${category}`) {
                    el.classList.remove('selected', 'border-wellcare-500', 'bg-wellcare-50', 'dark:bg-wellcare-900/20');
                    el.classList.add('border-gray-200', 'dark:border-gray-700');
                }
            });
            
            const selectedEl = document.getElementById(`category-${category}`);
            if (selectedEl) {
                selectedEl.classList.add('selected', 'border-wellcare-500', 'bg-wellcare-50', 'dark:bg-wellcare-900/20');
                selectedEl.classList.remove('border-gray-200', 'dark:border-gray-700');
            }
            
            const categoryField = document.getElementById('goal_category');
            if (categoryField) {
                categoryField.value = category;
                categoryField.dispatchEvent(new Event('change', { bubbles: true }));
            }
            
            const goalTypeField = document.getElementById('{{ form.goalType.vars.id }}');
            if (goalTypeField) {
                goalTypeField.value = category;
                goalTypeField.dispatchEvent(new Event('change', { bubbles: true }));
            }
            
            if (category === 'weight_loss') {
                if (targetFields) {
                    targetFields.style.opacity = '0.5';
                    targetFields.style.pointerEvents = 'none';
                }
            } else {
                if (targetFields) {
                    targetFields.style.opacity = '1';
                    targetFields.style.pointerEvents = 'auto';
                }
            }
            
            setTimeout(() => autoFillFields(category), 500);
        }

        async function autoFillFields(category) {
            const presets = {
                weight_loss: {
                    title: '{{ "Weight Management Goal" | trans }}',
                    description: '{{ "Achieve and maintain healthy body weight through balanced nutrition and exercise" | trans }}',
                    relevant: '{{ "Improve overall health, increase energy levels, and boost confidence" | trans }}',
                    difficultyLevel: 'medium',
                    targetAudience: 'beginner',
                    sessionsPerWeek: '3',
                    sessionDuration: '45',
                    caloriesTarget: '1800'
                },
                strength: {
                    title: '{{ "Strength Building Goal" | trans }}',
                    description: '{{ "Increase muscular strength and power through progressive resistance training" | trans }}',
                    relevant: '{{ "Build muscle, improve functional strength, and enhance physical performance" | trans }}',
                    targetValue: '10',
                    unit: 'kg',
                    difficultyLevel: 'medium',
                    targetAudience: 'intermediate',
                    sessionsPerWeek: '4',
                    sessionDuration: '60',
                    caloriesTarget: '2200'
                },
                endurance: {
                    title: '{{ "Endurance Enhancement Goal" | trans }}',
                    description: '{{ "Improve cardiovascular fitness and stamina for longer duration activities" | trans }}',
                    relevant: '{{ "Enhance cardiovascular health, increase stamina, and improve overall fitness" | trans }}',
                    targetValue: '30',
                    unit: 'minutes',
                    difficultyLevel: 'hard',
                    targetAudience: 'intermediate',
                    sessionsPerWeek: '5',
                    sessionDuration: '30',
                    caloriesTarget: '2500'
                },
                flexibility: {
                    title: '{{ "Flexibility & Mobility Goal" | trans }}',
                    description: '{{ "Enhance range of motion and joint mobility through stretching and mobility exercises" | trans }}',
                    relevant: '{{ "Improve posture, reduce injury risk, and enhance movement quality" | trans }}',
                    targetValue: '15',
                    unit: 'minutes',
                    difficultyLevel: 'easy',
                    targetAudience: 'beginner',
                    sessionsPerWeek: '7',
                    sessionDuration: '20',
                    caloriesTarget: '2000'
                },
                sports: {
                    title: '{{ "Sport Performance Goal" | trans }}',
                    description: '{{ "Enhance athletic performance for specific sports or physical activities" | trans }}',
                    relevant: '{{ "Improve sports performance, achieve competition goals, and enhance athletic skills" | trans }}',
                    targetValue: '10',
                    unit: 'points',
                    difficultyLevel: 'expert',
                    targetAudience: 'advanced',
                    sessionsPerWeek: '6',
                    sessionDuration: '90',
                    caloriesTarget: '2800'
                },
                rehabilitation: {
                    title: '{{ "Medical Rehabilitation Goal" | trans }}',
                    description: '{{ "Recover from injury or medical condition with guided exercise therapy" | trans }}',
                    relevant: '{{ "Regain functional abilities, reduce pain, and improve quality of life" | trans }}',
                    targetValue: '20',
                    unit: 'sessions',
                    difficultyLevel: 'easy',
                    targetAudience: 'beginner',
                    sessionsPerWeek: '2',
                    sessionDuration: '30',
                    caloriesTarget: '1900'
                }
            };
            
            if (presets[category]) {
                const preset = presets[category];
                
                // Mise à jour des champs
                const titleField = document.getElementById('{{ form.title.vars.id }}');
                const descField = document.getElementById('{{ form.description.vars.id }}');
                const relevantField = document.getElementById('{{ form.relevant.vars.id }}');
                const targetValueField = document.getElementById('{{ form.targetValue.vars.id }}');
                const unitField = document.getElementById('{{ form.unit.vars.id }}');
                const sessionsField = document.getElementById('{{ form.sessionsPerWeek.vars.id }}');
                const sessionDurField = document.getElementById('{{ form.sessionDuration.vars.id }}');
                const caloriesField = document.getElementById('{{ form.caloriesTarget.vars.id }}');
                const difficultyField = document.getElementById('{{ form.difficultyLevel.vars.id }}');
                const audienceField = document.getElementById('{{ form.targetAudience.vars.id }}');
                
                if (titleField) titleField.value = preset.title;
                if (descField) descField.value = preset.description;
                if (relevantField) relevantField.value = preset.relevant;
                if (targetValueField && preset.targetValue) targetValueField.value = preset.targetValue;
                if (unitField && preset.unit) unitField.value = preset.unit;
                if (sessionsField) sessionsField.value = preset.sessionsPerWeek;
                if (sessionDurField) sessionDurField.value = preset.sessionDuration;
                if (caloriesField) caloriesField.value = preset.caloriesTarget;
                if (difficultyField) difficultyField.value = preset.difficultyLevel;
                if (audienceField) audienceField.value = preset.targetAudience;
                
                const today = new Date();
                const startDate = today.toISOString().split('T')[0];
                const endDate = new Date(today);
                endDate.setDate(endDate.getDate() + 84);
                const targetDate = endDate.toISOString().split('T')[0];
                
                const startDateField = document.getElementById('{{ form.startDate.vars.id }}');
                const endDateField = document.getElementById('{{ form.endDate.vars.id }}');
                const statusField = document.getElementById('{{ form.status.vars.id }}');
                const dateField = document.getElementById('{{ form.date.vars.id }}');
                const progressField = document.getElementById('{{ form.progress.vars.id }}');
                
                if (startDateField) startDateField.value = startDate;
                if (endDateField) endDateField.value = targetDate;
                if (statusField) statusField.value = 'PENDING';
                if (dateField) dateField.value = startDate;
                if (progressField) {
                    progressField.value = '0';
                    updateProgressValue(0);
                }
                
                calculateDurationWeeks();
                updateDifficultyIndicator(preset.difficultyLevel);
            }
        }

        function calculateDurationWeeks() {
            const startDateField = document.getElementById('{{ form.startDate.vars.id }}');
            const endDateField = document.getElementById('{{ form.endDate.vars.id }}');
            const durationField = document.getElementById('{{ form.durationWeeks.vars.id }}');
            const durationMessage = document.getElementById('duration-message');
            
            if (startDateField && startDateField.value && endDateField && endDateField.value && durationField) {
                const startDate = new Date(startDateField.value);
                const endDate = new Date(endDateField.value);
                
                if (endDate > startDate) {
                    const diffTime = Math.abs(endDate - startDate);
                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                    const diffWeeks = Math.ceil(diffDays / 7);
                    
                    durationField.value = diffWeeks;
                    durationField.dispatchEvent(new Event('change', { bubbles: true }));
                    
                    if (durationMessage) {
                        durationMessage.classList.remove('hidden');
                        durationMessage.textContent = `{{ 'Calculated based on selected dates' | trans }} (${diffDays} days)`;
                    }
                }
            }
        }

        function updateDifficultyIndicator(level) {
            const indicator = document.getElementById('difficulty-indicator');
            if (!indicator) return;
            
            const levels = ['easy', 'medium', 'hard', 'expert'];
            const levelIndex = levels.indexOf(level);
            
            indicator.querySelectorAll('div').forEach((bar, index) => {
                bar.style.transition = 'all 0.3s ease';
                if (index <= levelIndex) {
                    bar.style.backgroundColor = index === 0 ? '#10b981' : 
                                               index === 1 ? '#f59e0b' : 
                                               index === 2 ? '#f97316' : 
                                               '#ef4444';
                } else {
                    bar.style.backgroundColor = '#e5e7eb';
                }
            });
        }

        function updateProgressValue(value) {
            const progressValue = document.getElementById('progress-value');
            if (progressValue) {
                progressValue.textContent = `${value}%`;
            }
            
            const progressField = document.getElementById('{{ form.progress.vars.id }}');
            if (progressField) {
                progressField.value = value;
            }
        }

        function updateSummary() {
            const categoryField = document.getElementById('goal_category');
            const titleField = document.getElementById('{{ form.title.vars.id }}');
            const durationField = document.getElementById('{{ form.durationWeeks.vars.id }}');
            const sessionsField = document.getElementById('{{ form.sessionsPerWeek.vars.id }}');
            
            const categoryMap = {
                'weight_loss': '{{ "Weight Management" | trans }}',
                'strength': '{{ "Strength Building" | trans }}',
                'endurance': '{{ "Endurance" | trans }}',
                'flexibility': '{{ "Flexibility & Mobility" | trans }}',
                'sports': '{{ "Sport Performance" | trans }}',
                'rehabilitation': '{{ "Medical Rehab" | trans }}'
            };
            
            const summaryCategory = document.getElementById('summary-category');
            const summaryTitle = document.getElementById('summary-title');
            const summaryDuration = document.getElementById('summary-duration');
            const summaryFrequency = document.getElementById('summary-frequency');
            const summaryCoach = document.getElementById('summary-coach');
            
            if (summaryCategory && categoryField) {
                summaryCategory.textContent = categoryMap[categoryField.value] || '-';
            }
            
            if (summaryTitle && titleField) {
                summaryTitle.textContent = titleField.value || '-';
            }
            
            if (summaryDuration && durationField) {
                summaryDuration.textContent = durationField.value ? `${durationField.value} weeks` : '- weeks';
            }
            
            if (summaryFrequency && sessionsField) {
                summaryFrequency.textContent = sessionsField.value ? `${sessionsField.value} sessions/week` : '- sessions/week';
            }
            
            const coachField = document.getElementById('goal_coachId');
            const coachCard = coachField?.value ? document.querySelector(`.coach-card[data-coach-id="${coachField.value}"]`) : null;
            
            if (summaryCoach) {
                if (coachCard && coachField?.value) {
                    summaryCoach.textContent = coachCard.dataset.coachName || 'Coach sélectionné';
                } else {
                    summaryCoach.textContent = '{{ "Aucun coach sélectionné" | trans }}';
                }
            }
        }

        function handleFormSubmit(event) {
            const commitmentField = document.getElementById('commitment-checkbox');
            if (commitmentField && !commitmentField.checked) {
                event.preventDefault();
                alert('{{ "Please confirm your commitment to this goal" | trans }}');
                return false;
            }
            
            if (submitButton) {
                submitButton.disabled = true;
                submitButton.innerHTML = `
                    <div class="flex items-center gap-3">
                        <div class="w-5 h-5 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                        <span class="font-medium">{{ 'Creating...' | trans }}</span>
                    </div>
                `;
            }
            
            return true;
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', async function() {
            const today = new Date().toISOString().split('T')[0];
            
            const statusField = document.getElementById('{{ form.status.vars.id }}');
            const dateField = document.getElementById('{{ form.date.vars.id }}');
            const progressField = document.getElementById('{{ form.progress.vars.id }}');
            
            if (statusField && !statusField.value) statusField.value = 'PENDING';
            if (dateField && !dateField.value) dateField.value = today;
            
            const startDateField = document.getElementById('{{ form.startDate.vars.id }}');
            const endDateField = document.getElementById('{{ form.endDate.vars.id }}');
            if (startDateField && !startDateField.value) startDateField.value = today;
            if (endDateField && !endDateField.value) {
                const endDate = new Date(today);
                endDate.setDate(endDate.getDate() + 84);
                endDateField.value = endDate.toISOString().split('T')[0];
                calculateDurationWeeks();
            }
            
            if (progressField && !progressField.value) {
                progressField.value = '0';
                updateProgressValue(0);
            }
            
            const currentCategory = document.getElementById('goal_category');
            if (currentCategory && currentCategory.value) {
                setTimeout(() => selectCategory(currentCategory.value), 300);
            }
            
            await new Promise(resolve => setTimeout(resolve, 200));
            const firstStepContent = document.getElementById('step-1-content');
            if (firstStepContent) {
                firstStepContent.style.opacity = '1';
                firstStepContent.style.transform = 'translateY(0)';
            }
            
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && e.target.tagName !== 'TEXTAREA' && e.target.tagName !== 'INPUT') {
                    e.preventDefault();
                    if (currentStep < totalSteps) {
                        nextStep(currentStep + 1);
                    } else if (currentStep === totalSteps && submitButton && !submitButton.disabled) {
                        document.getElementById('goal-form').requestSubmit();
                    }
                }
                
                if (e.key === 'ArrowLeft' && currentStep > 1) {
                    e.preventDefault();
                    prevStep(currentStep - 1);
                }
                if (e.key === 'ArrowRight' && currentStep < totalSteps) {
                    e.preventDefault();
                    nextStep(currentStep + 1);
                }
            });
            
            const form = document.getElementById('goal-form');
            if (form) {
                form.addEventListener('submit', handleFormSubmit);
            }
            
            const difficultyField = document.getElementById('{{ form.difficultyLevel.vars.id }}');
            if (difficultyField && difficultyField.value) {
                updateDifficultyIndicator(difficultyField.value);
            }
        });

        // Exposer les fonctions globales
        window.selectCategory = selectCategory;
        window.nextStep = nextStep;
        window.prevStep = prevStep;
        window.goToStep = goToStep;
        window.calculateDurationWeeks = calculateDurationWeeks;
        window.updateProgressValue = updateProgressValue;
        window.updateDifficultyIndicator = updateDifficultyIndicator;
        window.selectCoach = selectCoach;
        window.setupCoachSearch = setupCoachSearch;
    </script>
    
    <style>
        .step {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }
        .category-option.selected {
            transform: scale(1.02);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .progress-slider {
            -webkit-appearance: none;
            appearance: none;
        }
        .progress-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
            transition: all 0.2s ease;
        }
        .progress-slider::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
        }
        .progress-slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4f46e5;
            cursor: pointer;
            border: none;
            box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.2);
            transition: all 0.2s ease;
        }
        .progress-slider::-moz-range-thumb:hover {
            transform: scale(1.2);
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3);
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fade-in 0.3s ease forwards;
        }
        @keyframes slide-in-right {
            from { opacity: 0; transform: translateX(30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        .animate-slide-in-right {
            animation: slide-in-right 0.4s ease forwards;
        }
    </style>
{% endblock %}