{% extends 'layouts/app.html.twig' %}

{% block title %}{{ 'Milestone Tracker - WellCare Connect' | trans }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('fitness-css') }}
{% endblock %}

{% block body %}
<div class="min-h-screen bg-gray-50 dark:bg-gray-800" x-data="milestoneTracker()">
    {# Header #}
    <div class="bg-white shadow-sm dark:bg-gray-900">
        <div class="px-4 py-4 mx-auto max-w-7xl sm:px-6 lg:px-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="{{ path('fitness_dashboard') }}" class="text-gray-500 hover:text-gray-700 dark:text-gray-400">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                        </svg>
                    </a>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">{{ 'Milestone Tracker' | trans }}</h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Celebrate your achievements and track progress' | trans }}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <span class="px-3 py-1 text-sm font-medium rounded-full bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400">
                        üèÜ {{ totalPoints }} {{ 'points' | trans }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="px-4 py-8 mx-auto max-w-7xl sm:px-6 lg:px-8">
        {# Stats Overview #}
        <div class="grid grid-cols-2 gap-6 mb-8 md:grid-cols-4">
            <div class="p-6 text-center bg-white shadow-sm dark:bg-gray-900 rounded-xl">
                <div class="flex items-center justify-center w-16 h-16 mx-auto mb-3 bg-green-100 rounded-full dark:bg-green-900/30">
                    <svg class="w-8 h-8 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ completedMilestones }}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Completed' | trans }}</p>
            </div>

            <div class="p-6 text-center bg-white shadow-sm dark:bg-gray-900 rounded-xl">
                <div class="flex items-center justify-center w-16 h-16 mx-auto mb-3 bg-blue-100 rounded-full dark:bg-blue-900/30">
                    <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                </div>
                <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ inProgressMilestones }}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'In Progress' | trans }}</p>
            </div>

            <div class="p-6 text-center bg-white shadow-sm dark:bg-gray-900 rounded-xl">
                <div class="flex items-center justify-center w-16 h-16 mx-auto mb-3 rounded-full bg-amber-100 dark:bg-amber-900/30">
                    <svg class="w-8 h-8 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 18.657A8 8 0 016.343 7.343S7 9 9 10c0-2 .5-5 2.986-7C14 5 16.09 5.777 17.656 7.343A7.975 7.975 0 0120 13a7.975 7.975 0 01-2.343 5.657z"/>
                    </svg>
                </div>
                <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ currentStreak }}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Day Streak' | trans }}</p>
            </div>

            <div class="p-6 text-center bg-white shadow-sm dark:bg-gray-900 rounded-xl">
                <div class="flex items-center justify-center w-16 h-16 mx-auto mb-3 bg-purple-100 rounded-full dark:bg-purple-900/30">
                    <svg class="w-8 h-8 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                    </svg>
                </div>
                <p class="text-3xl font-bold text-gray-900 dark:text-white">{{ badgesEarned }}</p>
                <p class="text-sm text-gray-500 dark:text-gray-400">{{ 'Badges Earned' | trans }}</p>
            </div>
        </div>

        {# Achievement Levels #}
        <div class="p-6 mb-8 bg-white shadow-sm dark:bg-gray-900 rounded-xl">
            <h2 class="mb-6 text-lg font-semibold text-gray-900 dark:text-white">{{ 'Achievement Levels' | trans }}</h2>
            
            <div class="grid grid-cols-1 gap-4 md:grid-cols-4">
                {% for level in achievementLevels %}
                <div class="relative p-4 rounded-xl border-2 {% if level.unlocked %}border-wellcare-500 bg-wellcare-50 dark:bg-wellcare-900/20{% else %}border-gray-200 dark:border-gray-700{% endif %}">
                    {% if level.unlocked %}
                    <div class="absolute transform -translate-x-1/2 -top-3 left-1/2">
                        <span class="px-2 py-1 text-xs font-bold text-white rounded-full bg-wellcare-500">‚úì UNLOCKED</span>
                    </div>
                    {% endif %}
                    <div class="mb-3 text-center">
                        <div class="mb-2 text-4xl">{{ level.icon }}</div>
                        <h3 class="font-bold text-gray-900 dark:text-white">{{ level.name }}</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ level.requirement }}</p>
                    </div>
                    <div class="w-full h-2 mb-2 bg-gray-200 rounded-full dark:bg-gray-700">
                        <div class="h-2 rounded-full bg-wellcare-500" style="width: {{ level.progress }}%"></div>
                    </div>
                    <p class="text-xs text-center text-gray-500">{{ level.progress }}% complete</p>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="grid grid-cols-1 gap-8 lg:grid-cols-2">
            {# Weekly Achievements #}
            <div class="p-6 bg-white shadow-sm dark:bg-gray-900 rounded-xl">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">{{ 'Weekly Achievements' | trans }}</h2>
                    <span class="text-sm text-gray-500 dark:text-gray-400">{{ 'Week' }} {{ currentWeek }}</span>
                </div>

                <div class="space-y-4">
                    {% for achievement in weeklyAchievements %}
                    <div class="flex items-center p-4 rounded-lg border-2 {% if achievement.completed %}border-green-500 bg-green-50 dark:bg-green-900/20{% else %}border-gray-200 dark:border-gray-700{% endif %}">
                        <div class="w-12 h-12 rounded-full {% if achievement.completed %}bg-green-100 dark:bg-green-900/30{% else %}bg-gray-100 dark:bg-gray-800{% endif %} flex items-center justify-center mr-4">
                            <span class="text-2xl">{{ achievement.icon }}</span>
                        </div>
                        <div class="flex-1">
                            <h3 class="font-medium text-gray-900 dark:text-white" {% if achievement.completed %}class="line-through"{% endif %}>{{ achievement.title }}</h3>
                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ achievement.description }}</p>
                            {% if not achievement.completed %}
                            <div class="mt-2">
                                <div class="flex items-center justify-between mb-1 text-xs">
                                    <span class="text-gray-500">{{ 'Progress' | trans }}</span>
                                    <span class="text-gray-700 dark:text-gray-300">{{ achievement.current }}/{{ achievement.target }}</span>
                                </div>
                                <div class="w-full h-2 bg-gray-200 rounded-full dark:bg-gray-700">
                                    <div class="h-2 rounded-full bg-wellcare-500" style="width: {{ achievement.progress }}%"></div>
                                </div>
                            </div>
                            {% endif %}
                        </div>
                        <div class="ml-4 text-right">
                            <span class="text-lg font-bold text-wellcare-500">+{{ achievement.points }}</span>
                            <p class="text-xs text-gray-500">{{ 'points' | trans }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>

            {# Badges Collection #}
            <div class="p-6 bg-white shadow-sm dark:bg-gray-900 rounded-xl">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">{{ 'Badges Collection' | trans }}</h2>
                    <button class="text-sm text-wellcare-500 hover:text-wellcare-600">{{ 'View All' | trans }}</button>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    {% for badge in badges %}
                    <div class="text-center p-4 rounded-lg {% if badge.earned %}bg-wellcare-50 dark:bg-wellcare-900/20{% else %}bg-gray-50 dark:bg-gray-800{% endif %}">
                        <div class="text-4xl mb-2 {% if not badge.earned %}grayscale opacity-50{% endif %}">{{ badge.icon }}</div>
                        <h4 class="text-xs font-medium text-gray-900 dark:text-white" {% if not badge.earned %}class="text-gray-400"{% endif %}>{{ badge.name }}</h4>
                        {% if not badge.earned %}
                        <p class="mt-1 text-xs text-gray-500">{{ 'Locked' | trans }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>

                {# Next Badge Preview #}
                <div class="p-4 mt-6 rounded-lg bg-gray-50 dark:bg-gray-800">
                    <div class="flex items-center">
                        <div class="flex items-center justify-center w-16 h-16 mr-4 bg-gray-200 rounded-full dark:bg-gray-700">
                            <span class="text-3xl">üéØ</span>
                        </div>
                        <div class="flex-1">
                            <h4 class="font-medium text-gray-900 dark:text-white">{{ 'Next Badge' | trans }}</h4>
                            <p class="text-sm text-gray-500 dark:text-gray-400">{{ nextBadge.requirement }}</p>
                            <div class="mt-2">
                                <div class="flex items-center justify-between mb-1 text-xs">
                                    <span class="text-gray-500">{{ 'Progress' | trans }}</span>
                                    <span class="text-gray-700 dark:text-gray-300">{{ nextBadge.current }}/{{ nextBadge.target }}</span>
                                </div>
                                <div class="w-full h-2 bg-gray-200 rounded-full dark:bg-gray-700">
                                    <div class="h-2 rounded-full bg-amber-500" style="width: {{ nextBadge.progress }}%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {# Monthly Progress #}
        <div class="p-6 mt-8 bg-white shadow-sm dark:bg-gray-900 rounded-xl">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white">{{ 'Monthly Progress' | trans }}</h2>
                    <p class="text-sm text-gray-500 dark:text-gray-400">{{ monthName }} {{ year }}</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <p class="text-2xl font-bold text-wellcare-500">{{ monthlyPoints }}</p>
                        <p class="text-xs text-gray-500">{{ 'points earned' | trans }}</p>
                    </div>
                    <div class="w-24 h-24">
                        <canvas id="monthlyProgressChart"></canvas>
                    </div>
                </div>
            </div>

            {# Activity Heatmap #}
            <div class="mb-6">
                <h3 class="mb-4 font-medium text-gray-900 dark:text-white">{{ 'Activity Heatmap' | trans }}</h3>
                <div class="grid grid-cols-7 gap-2">
                    {% for day in activityHeatmap %}
                    <div class="aspect-square rounded flex items-center justify-center text-xs font-medium
                        {% if day.level == 4 %}bg-green-500 text-white
                        {% elseif day.level == 3 %}bg-green-300 dark:bg-green-700 text-gray-900 dark:text-white
                        {% elseif day.level == 2 %}bg-green-200 dark:bg-green-800 text-gray-900 dark:text-white
                        {% elseif day.level == 1 %}bg-green-100 dark:bg-green-900/30 text-gray-700 dark:text-gray-300
                        {% else %}bg-gray-100 dark:bg-gray-800 text-gray-400{% endif %}"
                         title="{{ day.date }}: {{ day.value }} points">
                        {{ day.day }}
                    </div>
                    {% endfor %}
                </div>
                <div class="flex items-center justify-end mt-2 space-x-2 text-xs text-gray-500">
                    <span>{{ 'Less' | trans }}</span>
                    <div class="w-4 h-4 bg-gray-100 rounded dark:bg-gray-800"></div>
                    <div class="w-4 h-4 bg-green-100 rounded dark:bg-green-900/30"></div>
                    <div class="w-4 h-4 bg-green-300 rounded dark:bg-green-700"></div>
                    <div class="w-4 h-4 bg-green-500 rounded"></div>
                    <span>{{ 'More' | trans }}</span>
                </div>
            </div>

            {# Monthly Challenges #}
            <h3 class="mb-4 font-medium text-gray-900 dark:text-white">{{ 'Monthly Challenges' | trans }}</h3>
            <div class="grid grid-cols-1 gap-4 md:grid-cols-3">
                {% for challenge in monthlyChallenges %}
                <div class="p-4 border border-gray-200 rounded-lg dark:border-gray-700">
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-2xl">{{ challenge.icon }}</span>
                        <span class="px-2 py-1 text-xs font-medium rounded-full {% if challenge.completed %}bg-green-100 text-green-600 dark:bg-green-900/30 dark:text-green-400{% else %}bg-gray-100 text-gray-600 dark:bg-gray-700 dark:text-gray-400{% endif %}">
                            {% if challenge.completed %}{{ 'Completed' | trans }}{% else %}{{ 'In Progress' | trans }}{% endif %}
                        </span>
                    </div>
                    <h4 class="font-medium text-gray-900 dark:text-white">{{ challenge.title }}</h4>
                    <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">{{ challenge.description }}</p>
                    <div class="mt-3">
                        <div class="flex items-center justify-between mb-1 text-xs">
                            <span class="text-gray-500">{{ 'Progress' | trans }}</span>
                            <span class="text-gray-700 dark:text-gray-300">{{ challenge.current }}/{{ challenge.target }}</span>
                        </div>
                        <div class="w-full h-2 bg-gray-200 rounded-full dark:bg-gray-700">
                            <div class="h-2 rounded-full bg-wellcare-500" style="width: {{ challenge.progress }}%"></div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        {# Leaderboard #}
        <div class="p-6 mt-8 bg-white shadow-sm dark:bg-gray-900 rounded-xl">
            <h2 class="mb-6 text-lg font-semibold text-gray-900 dark:text-white">{{ 'Fitness Leaderboard' | trans }}</h2>
            
            <div class="space-y-4">
                {% for user in leaderboard %}
                <div class="flex items-center p-4 rounded-lg {% if user.rank <= 3 %}bg-gradient-to-r from-amber-50 to-transparent dark:from-amber-900/20 dark:to-transparent border border-amber-200 dark:border-amber-800{% else %}bg-gray-50 dark:bg-gray-800{% endif %}">
                    <div class="flex items-center justify-center w-8 h-8 mr-4">
                        {% if user.rank == 1 %}
                        <span class="text-xl">ü•á</span>
                        {% elseif user.rank == 2 %}
                        <span class="text-xl">ü•à</span>
                        {% elseif user.rank == 3 %}
                        <span class="text-xl">ü•â</span>
                        {% else %}
                        <span class="text-lg font-bold text-gray-500">#{{ user.rank }}</span>
                        {% endif %}
                    </div>
                    <div class="flex items-center justify-center w-10 h-10 mr-4 bg-gray-200 rounded-full dark:bg-gray-700">
                        <span class="text-lg">{{ user.avatar }}</span>
                    </div>
                    <div class="flex-1">
                        <h4 class="font-medium text-gray-900 dark:text-white">{{ user.name }}</h4>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ user.achievement }}</p>
                    </div>
                    <div class="text-right">
                        <p class="font-bold text-wellcare-500">{{ user.points }}</p>
                        <p class="text-xs text-gray-500">{{ 'points' | trans }}</p>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    {# Celebration Modal #}
    <div x-show="showCelebration" x-cloak 
         class="fixed inset-0 z-50 flex items-center justify-center bg-black/50"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0"
         x-transition:enter-end="opacity-100">
        <div class="max-w-md p-8 mx-4 text-center bg-white dark:bg-gray-900 rounded-2xl"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0 transform scale-90"
             x-transition:enter-end="opacity-100 transform scale-100">
            <div class="mb-4 text-6xl animate-bounce">üéâ</div>
            <h2 class="mb-2 text-2xl font-bold text-gray-900 dark:text-white" x-text="celebrationTitle"></h2>
            <p class="mb-4 text-gray-600 dark:text-gray-400" x-text="celebrationMessage"></p>
            <div class="inline-block px-4 py-2 mb-4 rounded-full bg-wellcare-100 dark:bg-wellcare-900/30 text-wellcare-600 dark:text-wellcare-400">
                <span class="text-xl font-bold">+<span x-text="celebrationPoints"></span></span> {{ 'points' | trans }}
            </div>
            <button @click="showCelebration = false" class="px-6 py-2 text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                {{ 'Awesome!' | trans }}
            </button>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('fitness') }}
    <script>
        function milestoneTracker() {
            return {
                totalPoints: 2450,
                completedMilestones: 18,
                inProgressMilestones: 5,
                currentStreak: 12,
                badgesEarned: 12,
                currentWeek: 7,
                monthName: 'February',
                year: 2024,
                monthlyPoints: 320,
                showCelebration: false,
                celebrationTitle: '',
                celebrationMessage: '',
                celebrationPoints: 0,
                nextBadge: {
                    requirement: 'Complete 30 workouts',
                    current: 22,
                    target: 30,
                    progress: 73
                },
                init() {
                    this.initChart();
                },
                initChart() {
                    const ctx = document.getElementById('monthlyProgressChart');
                    if (ctx) {
                        new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: ['{{ 'Earned' | trans }}', '{{ 'Remaining' | trans }}'],
                                datasets: [{
                                    data: [320, 180],
                                    backgroundColor: ['#00A790', '#E5E7EB'],
                                    borderWidth: 0
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: true,
                                cutout: '70%',
                                plugins: {
                                    legend: {
                                        display: false
                                    }
                                }
                            }
                        });
                    }
                },
                celebrate(title, message, points) {
                    this.celebrationTitle = title;
                    this.celebrationMessage = message;
                    this.celebrationPoints = points;
                    this.showCelebration = true;
                }
            };
        }
    </script>
{% endblock %}
