{% extends 'layouts/app.html.twig' %}

{% block title %}{{ 'Log Workout - WellCare Connect' }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('fitness') }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    {{ encore_entry_script_tags('fitness') }}
{% endblock %}

{% block body %}
<div x-data="workoutLog()" class="min-h-screen bg-gray-50 dark:bg-gray-900">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 shadow-sm dark:bg-gray-800 dark:border-gray-700">
        <div class="px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-4">
                    <a href="{{ path('fitness_dashboard') }}" class="p-2 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                        <i class="text-gray-600 fas fa-arrow-left dark:text-gray-400"></i>
                    </a>
                    <div>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-clipboard-check text-wellcare-500"></i>
                            {{ 'Log Workout' }}
                        </h1>
                        <p class="text-sm text-gray-500 dark:text-gray-400">
                            {{ 'Record your completed exercises' }}
                        </p>
                    </div>
                </div>
                <div class="flex items-center gap-4">
                    <input type="date" x-model="workoutDate" class="text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500">
                    <button @click="saveWorkout()" class="px-4 py-2 font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                        <i class="mr-2 fas fa-save"></i>{{ 'Save Workout' }}
                    </button>
                </div>
            </div>
        </div>
    </header>

    <main class="p-6">
        <div class="grid grid-cols-1 gap-6 lg:grid-cols-4">
            <!-- Main Content -->
            <div class="space-y-6 lg:col-span-3">
                <!-- Quick Stats -->
                <div class="grid grid-cols-2 gap-4 md:grid-cols-4">
                    <div class="p-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-10 h-10 rounded-full bg-wellcare-100 dark:bg-wellcare-900/30">
                                <i class="fas fa-clock text-wellcare-500"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Duration' }}</p>
                                <p class="text-xl font-bold text-gray-900 dark:text-white"><span x-text="totalDuration"></span> {{ 'min' }}</p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-10 h-10 bg-red-100 rounded-full dark:bg-red-900/30">
                                <i class="text-red-500 fas fa-fire"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Calories' }}</p>
                                <p class="text-xl font-bold text-gray-900 dark:text-white"><span x-text="totalCalories"></span></p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-10 h-10 bg-blue-100 rounded-full dark:bg-blue-900/30">
                                <i class="text-blue-500 fas fa-dumbbell"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Exercises' }}</p>
                                <p class="text-xl font-bold text-gray-900 dark:text-white"><span x-text="exercises.length"></span></p>
                            </div>
                        </div>
                    </div>
                    <div class="p-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                        <div class="flex items-center gap-3">
                            <div class="flex items-center justify-center w-10 h-10 bg-green-100 rounded-full dark:bg-green-900/30">
                                <i class="text-green-500 fas fa-trophy"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Avg RPE' }}</p>
                                <p class="text-xl font-bold text-gray-900 dark:text-white"><span x-text="averageRPE"></span>/10</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Workout Type Selection -->
                <div class="p-6 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                    <h2 class="mb-4 font-semibold text-gray-900 dark:text-white">
                        <i class="mr-2 fas fa-tags text-wellcare-500"></i>
                        {{ 'Workout Type' }}
                    </h2>
                    <div class="flex flex-wrap gap-3">
                        {% for type in [
                            {id: 'strength', name: 'Strength', icon: 'fa-dumbbell'},
                            {id: 'cardio', name: 'Cardio', icon: 'fa-heart'},
                            {id: 'hiit', name: 'HIIT', icon: 'fa-bolt'},
                            {id: 'flexibility', name: 'Flexibility', icon: 'fa-expand'},
                            {id: 'core', name: 'Core', icon: 'fa-fire'},
                            {id: 'sports', name: 'Sports', icon: 'fa-running'}
                        ] %}
                        <button 
                            @click="selectWorkoutType('{{ type.id }}')"
                            :class="workoutType === '{{ type.id }}' ? 'bg-wellcare-500 text-white' : 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600'"
                            class="flex items-center gap-2 px-4 py-2 font-medium transition-colors rounded-lg">
                            <i class="fas {{ type.icon }}"></i>
                            {{ type.name }}
                        </button>
                        {% endfor %}
                    </div>
                </div>

                <!-- Exercises List -->
                <div class="p-6 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="font-semibold text-gray-900 dark:text-white">
                            <i class="mr-2 fas fa-list text-wellcare-500"></i>
                            {{ 'Exercises' }}
                        </h2>
                        <button @click="addExercise()" class="flex items-center gap-2 px-4 py-2 font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                            <i class="fas fa-plus"></i>
                            {{ 'Add Exercise' }}
                        </button>
                    </div>

                    <div class="space-y-4">
                        <template x-for="(exercise, index) in exercises" :key="exercise.id">
                            <div class="overflow-hidden border border-gray-200 dark:border-gray-700 rounded-xl">
                                <!-- Exercise Header -->
                                <div class="flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700/50">
                                    <div class="flex items-center gap-4">
                                        <span class="flex items-center justify-center w-8 h-8 font-medium rounded-full bg-wellcare-100 dark:bg-wellcare-900/30 text-wellcare-600 dark:text-wellcare-400" x-text="index + 1"></span>
                                        <input 
                                            type="text" 
                                            x-model="exercise.name"
                                            placeholder="{{ 'Exercise name' }}"
                                            class="w-48 font-medium text-gray-900 bg-transparent border-none dark:text-white focus:ring-0"
                                            @click="showExercisePicker(index)">
                                    </div>
                                    <div class="flex items-center gap-2">
                                        <!-- RPE Scale -->
                                        <div class="flex items-center gap-2">
                                            <span class="text-sm text-gray-500 dark:text-gray-400">{{ 'RPE' }}</span>
                                            <select x-model="exercise.rpe" class="w-16 text-sm bg-white border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-800">
                                                {% for i in 1..10 %}
                                                <option value="{{ i }}">{{ i }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                        <!-- Pain Tracking -->
                                        <button 
                                            @click="togglePainTracker(index)"
                                            class="p-2 transition-colors rounded-lg"
                                            :class="exercise.hasPain ? 'bg-red-100 dark:bg-red-900/30 text-red-600 dark:text-red-400' : 'bg-gray-100 dark:bg-gray-700 text-gray-500'">
                                            <i class="fas fa-heart-broken"></i>
                                        </button>
                                        <!-- Remove -->
                                        <button @click="removeExercise(index)" class="p-2 text-gray-400 transition-colors hover:text-red-500">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>

                                <!-- Sets & Reps -->
                                <div class="p-4">
                                    <div class="grid grid-cols-6 gap-3 mb-4">
                                        <div class="text-center">
                                            <p class="mb-1 text-xs text-gray-500 dark:text-gray-400">{{ 'Set' }}</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="mb-1 text-xs text-gray-500 dark:text-gray-400">{{ 'lbs/kg' }}</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="mb-1 text-xs text-gray-500 dark:text-gray-400">{{ 'Reps' }}</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="mb-1 text-xs text-gray-500 dark:text-gray-400">{{ 'RPE' }}</p>
                                        </div>
                                        <div class="text-center">
                                            <p class="mb-1 text-xs text-gray-500 dark:text-gray-400">{{ 'Completed' }}</p>
                                        </div>
                                        <div></div>
                                    </div>

                                    <template x-for="(set, setIndex) in exercise.sets" :key="setIndex">
                                        <div class="grid items-center grid-cols-6 gap-3 mb-2">
                                            <div class="text-center">
                                                <span class="text-sm font-medium text-gray-600 dark:text-gray-400" x-text="setIndex + 1"></span>
                                            </div>
                                            <div>
                                                <input 
                                                    type="number" 
                                                    x-model="set.weight"
                                                    placeholder="0"
                                                    class="w-full px-2 py-1 text-sm text-center text-gray-900 bg-white border border-gray-300 rounded dark:border-gray-600 dark:bg-gray-800 dark:text-white">
                                            </div>
                                            <div>
                                                <input 
                                                    type="number" 
                                                    x-model="set.reps"
                                                    placeholder="0"
                                                    class="w-full px-2 py-1 text-sm text-center text-gray-900 bg-white border border-gray-300 rounded dark:border-gray-600 dark:bg-gray-800 dark:text-white">
                                            </div>
                                            <div>
                                                <select x-model="set.rpe" class="w-full px-2 py-1 text-sm text-center text-gray-900 bg-white border border-gray-300 rounded dark:border-gray-600 dark:bg-gray-800 dark:text-white">
                                                    {% for i in 1..10 %}
                                                    <option value="{{ i }}">{{ i }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="text-center">
                                                <input 
                                                    type="checkbox" 
                                                    x-model="set.completed"
                                                    class="w-5 h-5 border-gray-300 rounded cursor-pointer text-wellcare-500 focus:ring-wellcare-500">
                                            </div>
                                            <div class="flex items-center gap-1">
                                                <button 
                                                    v-if="setIndex === exercise.sets.length - 1"
                                                    @click="addSet(index)"
                                                    class="p-1 text-wellcare-500 hover:text-wellcare-600">
                                                    <i class="fas fa-plus-circle"></i>
                                                </button>
                                                <button 
                                                    v-if="exercise.sets.length > 1"
                                                    @click="removeSet(index, setIndex)"
                                                    class="p-1 text-gray-400 hover:text-red-500">
                                                    <i class="fas fa-minus-circle"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </template>

                                    <!-- Duration for Cardio -->
                                    <div x-show="workoutType === 'cardio'" class="mt-4">
                                        <label class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">{{ 'Duration (minutes)' }}</label>
                                        <input type="number" x-model="exercise.duration" class="w-32 px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-800 dark:text-white">
                                    </div>

                                    <!-- Pain Tracker -->
                                    <div x-show="exercise.hasPain" class="p-4 mt-4 border border-red-200 rounded-lg bg-red-50 dark:bg-red-900/20 dark:border-red-800">
                                        <h4 class="mb-2 font-medium text-red-800 dark:text-red-200">
                                            <i class="mr-2 fas fa-exclamation-triangle"></i>{{ 'Pain/Discomfort Tracking' }}
                                        </h4>
                                        <div class="grid grid-cols-2 gap-4">
                                            <div>
                                                <label class="block mb-1 text-sm text-gray-700 dark:text-gray-300">{{ 'Pain Level (1-10)' }}</label>
                                                <input type="range" min="1" max="10" x-model="exercise.painLevel" class="w-full">
                                                <div class="flex justify-between text-xs text-gray-500">
                                                    <span>1</span>
                                                    <span x-text="exercise.painLevel" class="font-bold text-red-500"></span>
                                                    <span>10</span>
                                                </div>
                                            </div>
                                            <div>
                                                <label class="block mb-1 text-sm text-gray-700 dark:text-gray-300">{{ 'Location' }}</label>
                                                <select x-model="exercise.painLocation" class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-800 dark:text-white">
                                                    <option value="">{{ 'Select location' }}</option>
                                                    <option value="back">{{ 'Back' }}</option>
                                                    <option value="knee">{{ 'Knee' }}</option>
                                                    <option value="shoulder">{{ 'Shoulder' }}</option>
                                                    <option value="hip">{{ 'Hip' }}</option>
                                                    <option value="ankle">{{ 'Ankle' }}</option>
                                                    <option value="other">{{ 'Other' }}</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <label class="block mb-1 text-sm text-gray-700 dark:text-gray-300">{{ 'Notes' }}</label>
                                            <textarea x-model="exercise.painNotes" rows="2" class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-800 dark:text-white" placeholder="{{ 'Describe the pain or discomfort...' }}"></textarea>
                                        </div>
                                    </div>

                                    <!-- Notes -->
                                    <div class="mt-4">
                                        <label class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">{{ 'Notes' }}</label>
                                        <textarea x-model="exercise.notes" rows="2" class="w-full px-3 py-2 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-800 dark:text-white" placeholder="{{ 'Add any notes about this exercise...' }}"></textarea>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- Add Exercise Button -->
                    <button @click="addExercise()" class="flex items-center justify-center w-full gap-2 p-4 mt-4 text-gray-500 transition-colors border-2 border-gray-300 border-dashed dark:border-gray-600 rounded-xl dark:text-gray-400 hover:border-wellcare-500 hover:text-wellcare-500">
                        <i class="text-xl fas fa-plus-circle"></i>
                        {{ 'Add Another Exercise' }}
                    </button>
                </div>

                <!-- Form Check Section -->
                <div class="p-6 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                    <h2 class="mb-4 font-semibold text-gray-900 dark:text-white">
                        <i class="mr-2 fas fa-video text-wellcare-500"></i>
                        {{ 'Form Check' }}
                    </h2>
                    
                    <div class="p-8 text-center border-2 border-gray-300 border-dashed dark:border-gray-600 rounded-xl">
                        <div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 bg-gray-100 rounded-full dark:bg-gray-700">
                            <i class="text-2xl text-gray-400 fas fa-cloud-upload-alt"></i>
                        </div>
                        <h3 class="mb-2 font-medium text-gray-900 dark:text-white">{{ 'Upload a Video for Form Check' }}</h3>
                        <p class="mb-4 text-sm text-gray-500 dark:text-gray-400">{{ 'Your coach will review your form and provide feedback' }}</p>
                        <button class="px-4 py-2 font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                            <i class="mr-2 fas fa-upload"></i>{{ 'Upload Video' }}
                        </button>
                        <p class="mt-2 text-xs text-gray-400">{{ 'MP4, MOV up to 100MB' }}</p>
                    </div>
                </div>

                <!-- Overall Notes -->
                <div class="p-6 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                    <h2 class="mb-4 font-semibold text-gray-900 dark:text-white">
                        <i class="mr-2 fas fa-sticky-note text-wellcare-500"></i>
                        {{ 'Workout Notes' }}
                    </h2>
                    
                    <textarea x-model="overallNotes" rows="4" class="w-full px-4 py-3 text-gray-900 bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-800 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500" placeholder="{{ 'How did your workout feel? Any observations...' }}"></textarea>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="space-y-6 lg:col-span-1">
                <!-- Before/After -->
                <div class="p-6 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
                    <h3 class="mb-4 font-semibold text-gray-900 dark:text-white">
                        <i class="mr-2 fas fa-camera text-wellcare-500"></i>
                        {{ 'Progress Photos' }}
                    </h3>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <div class="p-4 text-center transition-colors border-2 border-gray-300 border-dashed rounded-lg cursor-pointer dark:border-gray-600 hover:border-wellcare-500">
                            <i class="mb-2 text-xl text-gray-400 fas fa-camera"></i>
                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'Before' }}</p>
                        </div>
                        <div class="p-4 text-center transition-colors border-2 border-gray-300 border-dashed rounded-lg cursor-pointer dark:border-gray-600 hover:border-wellcare-500">
                            <i class="mb-2 text-xl text-gray-400 fas fa-camera"></i>
                            <p class="text-xs text-gray-500 dark:text-gray-400">{{ 'After' }}</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Tips -->
                <div class="p-6 border bg-wellcare-50 dark:bg-wellcare-900/20 rounded-xl border-wellcare-200 dark:border-wellcare-800">
                    <h3 class="mb-4 font-semibold text-wellcare-800 dark:text-wellcare-200">
                        <i class="mr-2 fas fa-lightbulb"></i>{{ 'Coach Tips' }}
                    </h3>
                    
                    <ul class="space-y-2 text-sm text-wellcare-700 dark:text-wellcare-300">
                        <li class="flex items-start gap-2">
                            <i class="mt-1 fas fa-check text-wellcare-500"></i>
                            <span>{{ 'Log your workouts within 30 minutes of completion for accuracy' }}</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="mt-1 fas fa-check text-wellcare-500"></i>
                            <span>{{ 'Note any pain or discomfort immediately' }}</span>
                        </li>
                        <li class="flex items-start gap-2">
                            <i class="mt-1 fas fa-check text-wellcare-500"></i>
                            <span>{{ 'Upload form check videos for coach feedback' }}</span>
                        </li>
                    </ul>
                </div>

                <!-- Medical Alert -->
                <div class="p-6 border border-red-200 bg-red-50 dark:bg-red-900/20 rounded-xl dark:border-red-800">
                    <h3 class="mb-4 font-semibold text-red-800 dark:text-red-200">
                        <i class="mr-2 fas fa-heartbeat"></i>{{ 'Medical Safety' }}
                    </h3>
                    
                    <p class="mb-3 text-sm text-red-700 dark:text-red-300">
                        {{ 'If you experience any chest pain, dizziness, or severe shortness of breath, stop immediately and seek medical attention.' }}
                    </p>
                    
                    <button @click="emergencyStop()" class="flex items-center justify-center w-full gap-2 px-4 py-2 font-medium text-white transition-colors bg-red-500 rounded-lg hover:bg-red-600">
                        <i class="fas fa-phone"></i>
                        {{ 'Emergency Contact' }}
                    </button>
                </div>
            </div>
        </div>
    </main>

    <!-- Exercise Picker Modal -->
    <div x-show="showExercisePicker" style="display: none;" class="fixed inset-0 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen px-4">
            <div @click="showExercisePicker = false" class="fixed inset-0 bg-black bg-opacity-50"></div>
            
            <div class="relative z-10 w-full max-w-2xl bg-white shadow-xl dark:bg-gray-800 rounded-xl">
                <div class="p-6 border-b border-gray-200 dark:border-gray-700">
                    <h3 class="font-semibold text-gray-900 dark:text-white">{{ 'Select Exercise' }}</h3>
                </div>
                
                <div class="p-6">
                    <input type="text" placeholder="{{ 'Search exercises...' }}" class="w-full px-4 py-2 mb-4 text-gray-900 border border-gray-300 rounded-lg dark:border-gray-600 bg-gray-50 dark:bg-gray-700 dark:text-white focus:ring-wellcare-500 focus:border-wellcare-500">
                    
                    <div class="space-y-2 overflow-y-auto max-h-96">
                        {% for exercise in [
                            'Push-ups', 'Squats', 'Lunges', 'Plank', 'Burpees', 
                            'Dumbbell Rows', 'Shoulder Press', 'Bicep Curls', 
                            'Tricep Dips', 'Deadlifts', 'Bench Press', 'Pull-ups'
                        ] %}
                        <button @click="selectExercise('{{ exercise }}')" class="flex items-center justify-between w-full p-3 text-left transition-colors rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700">
                            <span class="text-gray-900 dark:text-white">{{ exercise }}</span>
                            <i class="fas fa-plus text-wellcare-500"></i>
                        </button>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Emergency Stop Button -->
    <div class="fixed bottom-6 right-6">
        <button @click="emergencyStop()" class="flex items-center justify-center text-white transition-all duration-200 bg-red-500 rounded-full shadow-lg w-14 h-14 hover:bg-red-600 hover:scale-110">
            <i class="text-xl fas fa-stop"></i>
        </button>
    </div>
</div>

<script>
document.addEventListener('alpine:init', () => {
    Alpine.data('workoutLog', () => ({
        darkMode: false,
        workoutDate: new Date().toISOString().split('T')[0],
        workoutType: 'strength',
        showExercisePicker: false,
        overallNotes: '',
        
        exercises: [
            {
                id: 1,
                name: 'Push-ups',
                sets: [
                    { weight: '', reps: 12, rpe: 7, completed: true },
                    { weight: '', reps: 12, rpe: 7, completed: true },
                    { weight: '', reps: 10, rpe: 8, completed: false }
                ],
                hasPain: false,
                painLevel: 1,
                painLocation: '',
                painNotes: '',
                notes: ''
            },
            {
                id: 2,
                name: 'Squats',
                sets: [
                    { weight: 40, reps: 12, rpe: 7, completed: true },
                    { weight: 40, reps: 12, rpe: 7, completed: true },
                    { weight: 40, reps: 10, rpe: 8, completed: false }
                ],
                hasPain: false,
                painLevel: 1,
                painLocation: '',
                painNotes: '',
                notes: ''
            }
        ],

        get totalDuration() {
            return this.exercises.reduce((sum, ex) => {
                const setsTime = ex.sets.length * 2;
                return sum + setsTime;
            }, 0) + 10;
        },

        get totalCalories() {
            return Math.round(this.exercises.length * 80);
        },

        get averageRPE() {
            let total = 0;
            let count = 0;
            this.exercises.forEach(ex => {
                ex.sets.forEach(set => {
                    if (set.completed) {
                        total += set.rpe;
                        count++;
                    }
                });
            });
            return count > 0 ? (total / count).toFixed(1) : '0';
        },

        init() {
            this.darkMode = localStorage.getItem('theme') === 'dark';
        },

        selectWorkoutType(type) {
            this.workoutType = type;
        },

        addExercise() {
            this.exercises.push({
                id: Date.now(),
                name: '',
                sets: [
                    { weight: '', reps: '', rpe: 7, completed: false }
                ],
                hasPain: false,
                painLevel: 1,
                painLocation: '',
                painNotes: '',
                notes: '',
                duration: ''
            });
        },

        removeExercise(index) {
            this.exercises.splice(index, 1);
        },

        addSet(exerciseIndex) {
            this.exercises[exerciseIndex].sets.push({
                weight: '',
                reps: '',
                rpe: 7,
                completed: false
            });
        },

        removeSet(exerciseIndex, setIndex) {
            this.exercises[exerciseIndex].sets.splice(setIndex, 1);
        },

        togglePainTracker(index) {
            this.exercises[index].hasPain = !this.exercises[index].hasPain;
        },

        showExercisePicker(index) {
            this.showExercisePicker = true;
        },

        selectExercise(exerciseName) {
            const emptyIndex = this.exercises.findIndex(ex => !ex.name);
            if (emptyIndex >= 0) {
                this.exercises[emptyIndex].name = exerciseName;
            } else {
                this.addExercise();
                this.exercises[this.exercises.length - 1].name = exerciseName;
            }
            this.showExercisePicker = false;
        },

        saveWorkout() {
            alert('Workout saved successfully!');
        },

        emergencyStop() {
            if (confirm('Are you experiencing any discomfort? This will pause your workout and contact emergency services.')) {
                window.location.href = '/emergency';
            }
        }
    }));
});
</script>
{% endblock %}
