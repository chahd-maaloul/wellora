{#
    Health Journals List Partial - Used for AJAX updates
#}

{# Calculate stats #}
{% set total = healthjournals|length %}
{% set activePeriods = 0 %}
{% set completed = 0 %}
{% set ongoing = 0 %}
{% for journal in healthjournals %}
    {% if journal.datefin and journal.datefin|date('Y-m-d') < 'now'|date('Y-m-d') %}
        {% set completed = completed + 1 %}
    {% else %}
        {% set ongoing = ongoing + 1 %}
    {% endif %}
{% endfor %}
{% set activePeriods = ongoing %}

{# Stats Cards #}
<div class="grid grid-cols-1 gap-4 mb-8 md:grid-cols-4" id="statsCards">
    <div class="p-4 bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-800">
        <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-wellcare-50 text-wellcare-600 dark:bg-wellcare-900/30 dark:text-wellcare-400">
                <i class="fa-solid fa-book-open"></i>
            </div>
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Total Journals</p>
                <p class="text-xl font-bold text-gray-900 dark:text-white" id="totalJournals">{{ total }}</p>
            </div>
        </div>
    </div>
    <div class="p-4 bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-800">
        <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-blue-50 text-blue-600 dark:bg-blue-900/30 dark:text-blue-400">
                <i class="fa-solid fa-calendar-check"></i>
            </div>
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Active Periods</p>
                <p class="text-xl font-bold text-gray-900 dark:text-white" id="activePeriods">{{ activePeriods }}</p>
            </div>
        </div>
    </div>
    <div class="p-4 bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-800">
        <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-emerald-50 text-emerald-600 dark:bg-emerald-900/30 dark:text-emerald-400">
                <i class="fa-solid fa-check-circle"></i>
            </div>
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Completed</p>
                <p class="text-xl font-bold text-gray-900 dark:text-white" id="completed">{{ completed }}</p>
            </div>
        </div>
    </div>
    <div class="p-4 bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-800">
        <div class="flex items-center gap-3">
            <div class="flex items-center justify-center w-10 h-10 rounded-lg bg-amber-50 text-amber-600 dark:bg-amber-900/30 dark:text-amber-400">
                <i class="fa-solid fa-clock"></i>
            </div>
            <div>
                <p class="text-sm text-gray-500 dark:text-gray-400">Ongoing</p>
                <p class="text-xl font-bold text-gray-900 dark:text-white" id="ongoing">{{ ongoing }}</p>
            </div>
        </div>
    </div>
</div>

{# Journals Grid #}
{% if healthjournals|length > 0 %}
    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 lg:grid-cols-3" id="journalsGrid">
        {% for journal in healthjournals %}
            <div class="p-6 bg-white border border-gray-100 shadow-sm transition-all hover:shadow-md rounded-xl dark:bg-gray-900 dark:border-gray-800">
                <div class="flex items-start justify-between mb-4">
                    <div class="flex items-center gap-3">
                        <div class="flex items-center justify-center w-12 h-12 rounded-xl {% if journal.datefin and journal.datefin|date('Y-m-d') < 'now'|date('Y-m-d') %}bg-gray-100 text-gray-600 dark:bg-gray-800 dark:text-gray-400{% else %}bg-wellcare-50 text-wellcare-600 dark:bg-wellcare-900/30 dark:text-wellcare-400{% endif %}">
                            <i class="fa-solid fa-journal-whills"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 dark:text-gray-400">
                                {% if journal.name %}{{ journal.name }}{% else %}Journal #{{ journal.id }}{% endif %}
                            </p>
                            <p class="font-semibold text-gray-900 dark:text-white">
                                {% if journal.datefin and journal.datefin|date('Y-m-d') < 'now'|date('Y-m-d') %}
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-800 dark:text-gray-300">
                                        Completed
                                    </span>
                                {% else %}
                                    <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-wellcare-100 text-wellcare-800 dark:bg-wellcare-900/30 dark:text-wellcare-400">
                                        Active
                                    </span>
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="space-y-3 mb-4">
                    <div class="flex items-center gap-2 text-sm">
                        <i class="fa-regular fa-calendar text-gray-400"></i>
                        <span class="text-gray-600 dark:text-gray-400">Start:</span>
                        <span class="font-medium text-gray-900 dark:text-white">{{ journal.datedebut|date('M d, Y') }}</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm">
                        <i class="fa-regular fa-calendar-check text-gray-400"></i>
                        <span class="text-gray-600 dark:text-gray-400">End:</span>
                        <span class="font-medium text-gray-900 dark:text-white">
                            {% if journal.datefin %}
                                {{ journal.datefin|date('M d, Y') }}
                            {% else %}
                                <span class="text-wellcare-600 dark:text-wellcare-400">Ongoing</span>
                            {% endif %}
                        </span>
                    </div>
                </div>

                <div class="flex items-center gap-2 pt-4 border-t border-gray-100 dark:border-gray-800">
                    <a href="{{ path('app_health_analytics') }}?journal_id={{ journal.id }}" 
                       class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium text-wellcare-700 bg-wellcare-50 rounded-lg hover:bg-wellcare-100 dark:bg-wellcare-900/30 dark:text-wellcare-400 dark:hover:bg-wellcare-900/50 transition-colors">
                        <i class="fa-solid fa-chart-line"></i>
                        View Analytics
                    </a>
                    <a href="{{ path('app_healthjournal_edit', {'id': journal.id}) }}" 
                       class="flex-1 inline-flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium text-amber-700 bg-amber-50 rounded-lg hover:bg-amber-100 dark:bg-amber-900/30 dark:text-amber-400 dark:hover:bg-amber-900/50 transition-colors">
                        <i class="fa-solid fa-pen"></i>
                        Edit
                    </a>
                    <form method="post" action="{{ path('app_healthjournal_delete', {'id': journal.id}) }}" 
                          onsubmit="return confirm('Are you sure you want to delete this journal?');" 
                          class="flex-1">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ journal.id) }}">
                        <button type="submit" 
                                class="w-full inline-flex items-center justify-center gap-2 px-3 py-2 text-sm font-medium text-rose-700 bg-rose-50 rounded-lg hover:bg-rose-100 dark:bg-rose-900/30 dark:text-rose-400 dark:hover:bg-rose-900/50 transition-colors">
                            <i class="fa-solid fa-trash"></i>
                            Delete
                        </button>
                    </form>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    {# Empty State #}
    <div class="p-12 text-center bg-white border border-gray-100 shadow-sm rounded-xl dark:bg-gray-900 dark:border-gray-800">
        <div class="flex items-center justify-center w-16 h-16 mx-auto mb-4 rounded-full bg-gray-100 dark:bg-gray-800">
            <i class="text-2xl fa-solid fa-book-open text-gray-400"></i>
        </div>
        <h3 class="mb-2 text-lg font-semibold text-gray-900 dark:text-white">No Journals Found</h3>
        <p class="mb-6 text-sm text-gray-500 dark:text-gray-400">
            {% if search|default('') or filterDate|default('') %}
                No journals match your search criteria. Try different filters.
            {% else %}
                Start tracking your health by creating your first journal entry.
            {% endif %}
        </p>
        <a href="{{ path('app_healthjournal_new') }}" 
           class="inline-flex items-center gap-2 px-6 py-3 text-sm font-medium text-white transition-colors rounded-lg bg-wellcare-600 hover:bg-wellcare-700">
            <i class="fa-solid fa-plus"></i>
            Create New Journal
        </a>
    </div>
{% endif %}
