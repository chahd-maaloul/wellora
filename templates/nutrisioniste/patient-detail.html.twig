{% extends 'base.html.twig' %}

{% block title %}Patient #{{ patientId }} - Nutrisioniste - WellCare{% endblock %}

{% block stylesheets %}
    {{ parent() }}
{% endblock %}

{% block body_class %}bg-gray-50 dark:bg-gray-900{% endblock %}

{% block body %}
<div class="min-h-screen py-8">
    <div class="px-4 mx-auto max-w-7xl">
        {# Header #}
        <div class="flex flex-col gap-4 mb-6 lg:flex-row lg:items-center lg:justify-between">
            <div>
                <div class="flex items-center gap-4">
                    <a href="{{ path('nutrisioniste_patients') }}" class="p-2 text-gray-400 hover:text-gray-600">
                        <i class="fas fa-arrow-left"></i>
                    </a>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">
                            Patient #{{ patientId }}
                        </h1>
                        <p class="mt-1 text-gray-500 dark:text-gray-400">Fiche patient et historique nutritionnel</p>
                    </div>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <a href="{{ path('nutrisioniste_message_view', { id: patientId }) }}" class="px-4 py-2 text-gray-700 border border-gray-300 rounded-lg dark:border-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <i class="mr-2 fas fa-envelope"></i>Envoyer message
                </a>
                <a href="{{ path('nutrisioniste_consultation_new') }}" class="px-4 py-2 font-medium text-white transition-colors rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                    <i class="mr-2 fas fa-calendar-plus"></i>Nouvelle Consultation
                </a>
            </div>
        </div>

        {# Stats Cards #}
        <div class="grid grid-cols-2 gap-4 mb-6 lg:grid-cols-5">
            <div class="p-4 bg-white dark:bg-gray-800 rounded-xl shadow">
                <p class="text-sm text-gray-500">Calories moyennes</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.avgCalories }}</p>
                <p class="text-xs text-gray-500">kcal/jour</p>
            </div>
            <div class="p-4 bg-white dark:bg-gray-800 rounded-xl shadow">
                <p class="text-sm text-gray-500">Protéines totales</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.totalProteins }}</p>
                <p class="text-xs text-gray-500">g (30 jours)</p>
            </div>
            <div class="p-4 bg-white dark:bg-gray-800 rounded-xl shadow">
                <p class="text-sm text-gray-500">Glucides totales</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.totalCarbs }}</p>
                <p class="text-xs text-gray-500">g (30 jours)</p>
            </div>
            <div class="p-4 bg-white dark:bg-gray-800 rounded-xl shadow">
                <p class="text-sm text-gray-500">Lipides totales</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.totalFats }}</p>
                <p class="text-xs text-gray-500">g (30 jours)</p>
            </div>
            <div class="p-4 bg-white dark:bg-gray-800 rounded-xl shadow">
                <p class="text-sm text-gray-500">Jours suivis</p>
                <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.logCount }}</p>
                <p class="text-xs text-gray-500">jours</p>
            </div>
        </div>

        <div class="grid grid-cols-1 gap-6 lg:grid-cols-3">
            {# Goals Info #}
            <div class="lg:col-span-1">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        <i class="mr-2 fas fa-bullseye"></i>
                        Objectifs nutritionnels
                    </h2>
                    {% if goal %}
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-500">Calories</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ goal.caloriesTarget|default(2000) }} kcal</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Protéines</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ goal.proteinTarget|default(120) }}g</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Glucides</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ goal.carbsTarget|default(250) }}g</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Lipides</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ goal.fatsTarget|default(70) }}g</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-500">Eau</span>
                            <span class="font-medium text-gray-900 dark:text-white">{{ goal.waterTarget|default(8) }} verres</span>
                        </div>
                    </div>
                    {% else %}
                    <p class="text-gray-500">Aucun objectif défini</p>
                    {% endif %}
                </div>
            </div>

            {# Recent Meals #}
            <div class="lg:col-span-2">
                <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6">
                    <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                        <i class="mr-2 fas fa-utensils"></i>
                        Historique récent
                    </h2>
                    
                    {% if foodLogs|length > 0 %}
                    <div class="space-y-3">
                        {% for log in foodLogs %}
                        <div class="flex items-center justify-between p-3 border border-gray-100 dark:border-gray-700 rounded-lg">
                            <div>
                                <p class="font-medium text-gray-900 dark:text-white">
                                    {% if log.mealType %}
                                        {{ log.mealType|title }}
                                    {% else %}
                                        Repas
                                    {% endif %}
                                </p>
                                <p class="text-sm text-gray-500">{{ log.date|date('d M Y') }}</p>
                            </div>
                            <div class="text-right">
                                <p class="font-medium text-gray-900 dark:text-white">{{ log.totalCalories|default(0) }} kcal</p>
                                <p class="text-xs text-gray-500">P:{{ log.protein|default(0) }}g G:{{ log.carbs|default(0) }}g L:{{ log.fats|default(0) }}g</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <p class="text-gray-500 text-center py-4">Aucun historique disponible</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}