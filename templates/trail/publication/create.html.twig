{% extends 'layouts/app.html.twig' %}

{% block title %}Share Your Experience - WellCare Connect{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {{ encore_entry_link_tags('trail-css') }}
{% endblock %}

{% block body %}
{# Page Header #}
<div class="py-4 mb-4 -mx-4 -mt-4 bg-gradient-to-r from-wellcare-500 to-wellcare-light-500">
    <div class="px-4 mx-auto">
        <div class="flex items-center gap-4">
            <a href="/trail/detail" class="p-2 text-white transition rounded-lg bg-white/20 hover:bg-white/30">
                <i class="fa-solid fa-arrow-left"></i>
            </a>
            <div>
                <h1 class="text-xl font-bold text-white font-display">
                    <i class="mr-2 fa-solid fa-camera"></i>Share Your Experience
                </h1>
                <p class="text-sm text-white/80">Forest Wellness Path</p>
            </div>
        </div>
    </div>
</div>

{# Main Content #}
<div class="px-4 mx-auto" x-data="publicationForm()">
    <form @submit.prevent="submitPublication()" class="max-w-3xl mx-auto">
        <!-- Trail Selection -->
        <div class="p-4 mb-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
            <h2 class="mb-3 text-base font-semibold text-gray-900 dark:text-white">
                <i class="mr-2 fa-solid fa-map-pin text-wellcare-500"></i>Trail Information
            </h2>
            <div class="flex items-center gap-3 p-3 rounded-lg bg-gray-50 dark:bg-gray-700/50">
                <img src="https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=100&h=100&fit=crop" alt="Trail" class="object-cover w-12 h-12 rounded-lg">
                <div>
                    <p class="font-medium text-gray-900 dark:text-white">Forest Wellness Path</p>
                    <p class="text-xs text-gray-500">5.2 km ‚Ä¢ Moderate ‚Ä¢ ‚òÖ 4.9</p>
                </div>
            </div>
        </div>

        <!-- Visit Date & Conditions -->
        <div class="p-4 mb-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
            <h2 class="mb-3 text-base font-semibold text-gray-900 dark:text-white">
                <i class="mr-2 fa-solid fa-calendar text-wellcare-500"></i>When did you visit?
            </h2>
            <div class="grid gap-3 md:grid-cols-2">
                <div>
                    <label class="block mb-1 text-xs font-medium text-gray-500 dark:text-gray-400">Date of Visit</label>
                    <input type="date" class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                </div>
                <div>
                    <label class="block mb-1 text-xs font-medium text-gray-500 dark:text-gray-400">Weather Conditions</label>
                    <select class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                        <option value="">Select condition</option>
                        <option value="sunny">‚òÄÔ∏è Sunny</option>
                        <option value="cloudy">‚òÅÔ∏è Cloudy</option>
                        <option value="partly-cloudy">‚õÖ Partly Cloudy</option>
                        <option value="rainy">üåßÔ∏è Light Rain</option>
                        <option value="foggy">üå´Ô∏è Foggy</option>
                        <option value="snow">‚ùÑÔ∏è Snow</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Ratings -->
        <div class="p-4 mb-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
            <h2 class="mb-3 text-base font-semibold text-gray-900 dark:text-white">
                <i class="mr-2 fa-solid fa-star text-wellcare-500"></i>Rate your experience
            </h2>
            
            <!-- Ambiance Rating -->
            <div class="mb-4">
                <p class="mb-2 text-sm text-gray-700 dark:text-gray-300">üåø Scenery & Ambiance</p>
                <div class="flex items-center gap-2">
                    <template x-for="star in 5">
                        <button type="button" 
                            @click="ratings.ambiance = star"
                            class="text-xl transition hover:scale-110"
                            :class="star <= ratings.ambiance ? 'text-amber-400' : 'text-gray-300'">
                            <i class="fa-solid fa-star"></i>
                        </button>
                    </template>
                    <span class="ml-2 text-xs text-gray-500" x-text="ratings.ambiance + '/5'"></span>
                </div>
            </div>
            
            <!-- Safety Rating -->
            <div class="mb-4">
                <p class="mb-2 text-sm text-gray-700 dark:text-gray-300">üõ°Ô∏è Safety & Maintenance</p>
                <div class="flex items-center gap-2">
                    <template x-for="star in 5">
                        <button type="button" 
                            @click="ratings.safety = star"
                            class="text-xl transition hover:scale-110"
                            :class="star <= ratings.safety ? 'text-amber-400' : 'text-gray-300'">
                            <i class="fa-solid fa-star"></i>
                        </button>
                    </template>
                    <span class="ml-2 text-xs text-gray-500" x-text="ratings.safety + '/5'"></span>
                </div>
            </div>

            <!-- Difficulty Rating -->
            <div>
                <p class="mb-2 text-sm text-gray-700 dark:text-gray-300">‚õ∞Ô∏è Overall Experience</p>
                <div class="flex items-center gap-2">
                    <template x-for="star in 5">
                        <button type="button" 
                            @click="ratings.overall = star"
                            class="text-xl transition hover:scale-110"
                            :class="star <= ratings.overall ? 'text-amber-400' : 'text-gray-300'">
                            <i class="fa-solid fa-star"></i>
                        </button>
                    </template>
                    <span class="ml-2 text-xs text-gray-500" x-text="ratings.overall + '/5'"></span>
                </div>
            </div>
        </div>

        <!-- Review Text -->
        <div class="p-4 mb-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
            <h2 class="mb-3 text-base font-semibold text-gray-900 dark:text-white">
                <i class="mr-2 fa-solid fa-pen text-wellcare-500"></i>Share your thoughts
            </h2>
            <textarea 
                rows="5"
                placeholder="Tell us about your trail experience. What did you enjoy? Any tips for future visitors?"
                class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg resize-none dark:border-gray-600 dark:bg-gray-700 dark:text-white"></textarea>
        </div>

        <!-- Tips Section -->
        <div class="p-4 mb-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
            <h2 class="mb-3 text-base font-semibold text-gray-900 dark:text-white">
                <i class="mr-2 fa-solid fa-lightbulb text-wellcare-500"></i>Tips for future visitors
            </h2>
            <div class="grid gap-3 md:grid-cols-2">
                <div>
                    <label class="block mb-1 text-xs font-medium text-gray-500 dark:text-gray-400">Best time to visit</label>
                    <select class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                        <option value="">Select time</option>
                        <option value="early-morning">üåÖ Early Morning</option>
                        <option value="late-morning">‚òÄÔ∏è Late Morning</option>
                        <option value="afternoon">üå§Ô∏è Afternoon</option>
                        <option value="sunset">üåá Sunset</option>
                        <option value="any">‚è∞ Any Time</option>
                    </select>
                </div>
                <div>
                    <label class="block mb-1 text-xs font-medium text-gray-500 dark:text-gray-400">Recommended gear</label>
                    <input type="text" placeholder="e.g., Hiking boots, water..."
                        class="w-full px-3 py-2 text-sm border border-gray-200 rounded-lg dark:border-gray-600 dark:bg-gray-700 dark:text-white">
                </div>
            </div>
        </div>

        <!-- Photo Upload -->
        <div class="p-4 mb-4 bg-white border border-gray-100 shadow-sm dark:bg-gray-800 rounded-xl dark:border-gray-700">
            <h2 class="mb-3 text-base font-semibold text-gray-900 dark:text-white">
                <i class="mr-2 fa-solid fa-image text-wellcare-500"></i>Share photos
            </h2>
            <div class="relative p-6 text-center border-2 border-dashed rounded-xl drag-area" 
                @dragover.prevent="$event.dataTransfer.dropEffect = 'copy'"
                @drop.prevent="handleFiles($event.dataTransfer.files)"
                @dragenter.prevent
                @dragleave.prevent>
                <input type="file" multiple accept="image/*" class="absolute inset-0 opacity-0 cursor-pointer"
                    @change="handleFiles($event.target.files)">
                <i class="mb-2 text-3xl text-gray-400 fa-solid fa-cloud-arrow-up"></i>
                <p class="text-sm text-gray-500">Drag & drop photos here or <span class="text-wellcare-500">browse</span></p>
                <p class="mt-1 text-xs text-gray-400">PNG, JPG up to 10MB each</p>
            </div>
            
            <!-- Photo Previews -->
            <div class="grid grid-cols-4 gap-2 mt-3" x-show="photos.length > 0">
                <template x-for="(photo, index) in photos" :key="index">
                    <div class="relative aspect-square group">
                        <img :src="photo.preview" class="object-cover w-full h-full rounded-lg">
                        <button type="button" @click="photos.splice(index, 1)"
                            class="absolute top-0 right-0 p-1 text-xs text-white bg-red-500 rounded-full opacity-0 group-hover:opacity-100">
                            <i class="fa-solid fa-times"></i>
                        </button>
                    </div>
                </template>
            </div>
        </div>

        <!-- Submit Buttons -->
        <div class="flex gap-3">
            <button type="button" @click="saveDraft()"
                class="flex-1 px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 dark:bg-gray-700 dark:text-gray-300 dark:hover:bg-gray-600">
                <i class="mr-1 fa-solid fa-floppy-disk"></i>Save Draft
            </button>
            <button type="submit"
                class="flex-1 px-4 py-2 text-sm font-medium text-white rounded-lg bg-wellcare-500 hover:bg-wellcare-600">
                <i class="mr-1 fa-solid fa-paper-plane"></i>Publish Review
            </button>
        </div>
    </form>
</div>

<script>
function publicationForm() {
    return {
        ratings: {
            ambiance: 0,
            safety: 0,
            overall: 0
        },
        photos: [],
        
        handleFiles(files) {
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = e => {
                        this.photos.push({
                            file: file,
                            preview: e.target.result
                        });
                    };
                    reader.readAsDataURL(file);
                }
            });
        },
        
        submitPublication() {
            alert('Publication submitted successfully!');
        },
        
        saveDraft() {
            alert('Draft saved!');
        }
    }
}
</script>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
{% endblock %}
