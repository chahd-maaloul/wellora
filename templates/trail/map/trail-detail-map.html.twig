<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trail Detail Map - WellCare Connect</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/leaflet.fullscreen.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.fullscreen/1.6.0/Leaflet.fullscreen.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f0f9f6; }
        
        .trail-header {
            background: linear-gradient(135deg, #00A790 0%, #00DBB6 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .trail-info h1 { font-size: 1.8rem; margin-bottom: 8px; }
        .trail-meta { display: flex; gap: 20px; font-size: 0.95rem; opacity: 0.9; }
        .trail-actions { display: flex; gap: 12px; }
        
        .action-btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary { background: white; color: #00A790; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
        .btn-secondary { background: rgba(255,255,255,0.2); color: white; }
        .btn-secondary:hover { background: rgba(255,255,255,0.3); }
        
        .main-content { display: flex; height: calc(100vh - 100px); }
        
        .trail-sidebar {
            width: 380px;
            background: white;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }
        
        .sidebar-section { padding: 20px; border-bottom: 1px solid #e5e7eb; }
        .section-title {
            font-size: 0.85rem;
            text-transform: uppercase;
            color: #6b7280;
            margin-bottom: 15px;
            letter-spacing: 0.5px;
        }
        
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; }
        .stat-card {
            background: #f9fafb;
            padding: 15px;
            border-radius: 12px;
            text-align: center;
        }
        .stat-icon { font-size: 1.5rem; margin-bottom: 8px; }
        .stat-value { font-size: 1.4rem; font-weight: 700; color: #00A790; }
        .stat-label { font-size: 0.8rem; color: #6b7280; margin-top: 4px; }
        
        .elevation-chart { height: 150px; margin-top: 15px; }
        
        .waypoint-list { margin-top: 15px; }
        .waypoint-item {
            display: flex;
            align-items: flex-start;
            padding: 12px;
            margin: 8px 0;
            background: #f9fafb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .waypoint-item:hover { background: #f0f9f6; transform: translateX(5px); }
        .waypoint-number {
            width: 30px;
            height: 30px;
            background: #00A790;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 0.85rem;
            margin-right: 12px;
            flex-shrink: 0;
        }
        .waypoint-info h4 { font-size: 0.95rem; margin-bottom: 4px; }
        .waypoint-info p { font-size: 0.8rem; color: #6b7280; }
        .waypoint-distance { margin-left: auto; font-size: 0.85rem; color: #00A790; font-weight: 600; }
        
        .amenities-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 15px; }
        .amenity-item {
            text-align: center;
            padding: 12px 8px;
            background: #f9fafb;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .amenity-item:hover { background: #f0f9f6; transform: translateY(-2px); }
        .amenity-icon { font-size: 1.5rem; margin-bottom: 5px; }
        .amenity-name { font-size: 0.75rem; color: #6b7280; }
        
        .weather-widget {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 12px;
            color: white;
            margin-top: 15px;
        }
        .weather-icon { font-size: 3rem; }
        .weather-temp { font-size: 2rem; font-weight: 700; }
        .weather-info h4 { font-size: 1rem; margin-bottom: 5px; }
        .weather-info p { font-size: 0.85rem; opacity: 0.9; }
        
        .safety-alert {
            background: #fef3c7;
            border: 1px solid #f59e0b;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            display: flex;
            align-items: flex-start;
            gap: 12px;
        }
        .safety-icon { font-size: 1.5rem; }
        .safety-info h4 { font-size: 0.95rem; color: #92400e; margin-bottom: 5px; }
        .safety-info p { font-size: 0.8rem; color: #a16207; }
        
        .map-container { flex: 1; position: relative; }
        #trail-detail-map { height: 100%; width: 100%; }
        
        .map-controls {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .control-btn {
            width: 45px;
            height: 45px;
            background: white;
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.2s;
        }
        .control-btn:hover { background: #f0f9f6; transform: scale(1.05); }
        
        .progress-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 1000;
        }
        
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .progress-title { font-weight: 600; font-size: 1rem; }
        .progress-stats { display: flex; gap: 20px; font-size: 0.9rem; }
        .progress-bar-container { height: 12px; background: #e5e7eb; border-radius: 6px; overflow: hidden; }
        .progress-bar { height: 100%; background: linear-gradient(90deg, #00A790 0%, #00DBB6 100%); border-radius: 6px; transition: width 0.3s; }
        
        .eta-display {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e5e7eb;
        }
        .eta-item { display: flex; align-items: center; gap: 8px; }
        .eta-icon { font-size: 1.2rem; }
        .eta-info h4 { font-size: 0.85rem; color: #6b7280; }
        .eta-info p { font-size: 1.1rem; font-weight: 600; color: #00A790; }
        
        @media (max-width: 1024px) {
            .main-content { flex-direction: column; height: auto; }
            .trail-sidebar { width: 100%; max-height: 40vh; }
            .map-container { height: 50vh; }
            .progress-panel { left: 10px; right: 10px; bottom: 10px; }
        }
    </style>
</head>
<body>
    <div x-data="trailDetailMap()">
        <!-- Trail Header -->
        <div class="trail-header">
            <div class="trail-info">
                <h1>üèîÔ∏è Pine Ridge Trail</h1>
                <div class="trail-meta">
                    <span>üìè 5.2 km</span>
                    <span>‚è±Ô∏è 1h 30m</span>
                    <span>üìç Portland, OR</span>
                    <span>‚≠ê 4.8 (124 reviews)</span>
                </div>
            </div>
            <div class="trail-actions">
                <button class="action-btn btn-primary" @click="startNavigation()">
                    ‚ñ∂Ô∏è Start Trail
                </button>
                <button class="action-btn btn-secondary" @click="downloadGPX()">
                    üì• Download GPX
                </button>
                <button class="action-btn btn-secondary" @click="shareTrail()">
                    üì§ Share
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- Left Sidebar -->
            <div class="trail-sidebar">
                <!-- Stats Section -->
                <div class="sidebar-section">
                    <div class="section-title">üìä Trail Statistics</div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon">üìè</div>
                            <div class="stat-value">5.2</div>
                            <div class="stat-label">Distance (km)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚õ∞Ô∏è</div>
                            <div class="stat-value">270</div>
                            <div class="stat-label">Elevation Gain (m)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">‚è±Ô∏è</div>
                            <div class="stat-value">90</div>
                            <div class="stat-label">Duration (min)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">üìà</div>
                            <div class="stat-value">420</div>
                            <div class="stat-label">Max Elevation (m)</div>
                        </div>
                    </div>
                </div>
                
                <!-- Elevation Profile -->
                <div class="sidebar-section">
                    <div class="section-title">üìà Elevation Profile</div>
                    <div class="elevation-chart">
                        <canvas id="elevationProfileChart"></canvas>
                    </div>
                </div>
                
                <!-- Waypoints -->
                <div class="sidebar-section">
                    <div class="section-title">üö© Waypoints</div>
                    <div class="waypoint-list">
                        <template x-for="(waypoint, index) in waypoints" :key="index">
                            <div class="waypoint-item" @click="flyToWaypoint(waypoint, index)">
                                <div class="waypoint-number" x-text="index + 1"></div>
                                <div class="waypoint-info">
                                    <h4 x-text="waypoint.name"></h4>
                                    <p x-text="waypoint.description"></p>
                                </div>
                                <div class="waypoint-distance" x-text="waypoint.distance"></div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- Amenities -->
                <div class="sidebar-section">
                    <div class="section-title">üè™ Amenities</div>
                    <div class="amenities-grid">
                        <div class="amenity-item">
                            <div class="amenity-icon">üöª</div>
                            <div class="amenity-name">Restrooms</div>
                        </div>
                        <div class="amenity-item">
                            <div class="amenity-icon">üöø</div>
                            <div class="amenity-name">Water</div>
                        </div>
                        <div class="amenity-item">
                            <div class="amenity-icon">üÖøÔ∏è</div>
                            <div class="amenity-name">Parking</div>
                        </div>
                        <div class="amenity-item">
                            <div class="amenity-icon">üéØ</div>
                            <div class="amenity-name">First Aid</div>
                        </div>
                    </div>
                </div>
                
                <!-- Weather -->
                <div class="sidebar-section">
                    <div class="section-title">üå§Ô∏è Current Conditions</div>
                    <div class="weather-widget">
                        <div class="weather-icon">‚òÄÔ∏è</div>
                        <div class="weather-temp">18¬∞C</div>
                        <div class="weather-info">
                            <h4>Clear Sky</h4>
                            <p>Humidity: 65% | Wind: 12 km/h NW</p>
                        </div>
                    </div>
                </div>
                
                <!-- Safety -->
                <div class="sidebar-section">
                    <div class="section-title">‚ö†Ô∏è Trail Safety</div>
                    <div class="safety-alert">
                        <div class="safety-icon">ü¶å</div>
                        <div class="safety-info">
                            <h4>Wildlife Activity</h4>
                            <p>Recent wildlife sightings reported. Stay on marked trails and make noise while hiking.</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Map -->
            <div class="map-container">
                <div id="trail-detail-map"></div>
                
                <div class="map-controls">
                    <button class="control-btn" @click="zoomIn()">‚ûï</button>
                    <button class="control-btn" @click="zoomOut()">‚ûñ</button>
                    <button class="control-btn" @click="toggleFullscreen()">‚õ∂</button>
                    <button class="control-btn" @click="centerOnTrail()">üéØ</button>
                </div>
                
                <!-- Progress Panel -->
                <div class="progress-panel" x-show="isNavigating">
                    <div class="progress-header">
                        <span class="progress-title">üèÉ Trail Progress</span>
                        <div class="progress-stats">
                            <span>üìè <span x-text="currentDistance"></span> km / <span x-text="totalDistance"></span> km</span>
                            <span>‚è±Ô∏è <span x-text="elapsedTime"></span></span>
                        </div>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" :style="'width: ' + progressPercent + '%'"></div>
                    </div>
                    <div class="eta-display">
                        <div class="eta-item">
                            <div class="eta-icon">üèÅ</div>
                            <div class="eta-info">
                                <h4>Distance Remaining</h4>
                                <p x-text="remainingDistance + ' km'"></p>
                            </div>
                        </div>
                        <div class="eta-item">
                            <div class="eta-icon">‚è∞</div>
                            <div class="eta-info">
                                <h4>ETA</h4>
                                <p x-text="eta"></p>
                            </div>
                        </div>
                        <div class="eta-item">
                            <div class="eta-icon">üìç</div>
                            <div class="eta-info">
                                <h4>Next Waypoint</h4>
                                <p x-text="nextWaypoint"></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function trailDetailMap() {
            return {
                map: null,
                trailPolyline: null,
                isNavigating: false,
                progressPercent: 0,
                currentDistance: 0,
                totalDistance: 5.2,
                elapsedTime: '00:00',
                remainingDistance: 5.2,
                eta: '1h 30m',
                nextWaypoint: 'Crystal Spring',
                waypoints: [
                    { name: 'Pine Ridge Trailhead', description: 'Starting point with parking', distance: '0.0 km', lat: 45.5234, lng: -122.6762 },
                    { name: 'Crystal Spring', description: 'Drinking water available', distance: '0.8 km', lat: 45.5240, lng: -122.6780 },
                    { name: 'Meadow View', description: 'Open meadow with wildflowers', distance: '1.5 km', lat: 45.5250, lng: -122.6800 },
                    { name: 'Eagle Lookout', description: 'Scenic viewpoint', distance: '2.3 km', lat: 45.5265, lng: -122.6790 },
                    { name: 'Forest Junction', description: 'Trail intersection', distance: '3.2 km', lat: 45.5275, lng: -122.6770 },
                    { name: 'Ridge Top', description: 'Highest point on trail', distance: '4.0 km', lat: 45.5285, lng: -122.6750 },
                    { name: 'Pine Ridge Trailhead', description: 'End of loop', distance: '5.2 km', lat: 45.5234, lng: -122.6762 }
                ],
                
                init() {
                    this.$nextTick(() => {
                        this.initMap();
                        this.initChart();
                    });
                },
                
                initMap() {
                    this.map = L.map('trail-detail-map').setView([45.5250, -122.6780], 14);
                    
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '¬© OpenStreetMap contributors'
                    }).addTo(this.map);
                    
                    // Add trail polyline
                    const trailCoords = this.waypoints.map(wp => [wp.lat, wp.lng]);
                    
                    this.trailPolyline = L.polyline(trailCoords, {
                        color: '#00A790',
                        weight: 6,
                        opacity: 0.9,
                        dashArray: '10, 10'
                    }).addTo(this.map);
                    
                    // Add start/end markers
                    const startIcon = L.divIcon({
                        html: '<div style="background: #22c55e; width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 18px; border: 3px solid white; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">üö©</div>',
                        className: 'start-marker'
                    });
                    
                    const endIcon = L.divIcon({
                        html: '<div style="background: #ef4444; width: 35px; height: 35px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 16px; border: 3px solid white; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">üèÅ</div>',
                        className: 'end-marker'
                    });
                    
                    L.marker(trailCoords[0], { icon: startIcon })
                        .addTo(this.map)
                        .bindPopup('<strong>Start</strong><br>Pine Ridge Trailhead');
                    
                    L.marker(trailCoords[trailCoords.length - 1], { icon: endIcon })
                        .addTo(this.map)
                        .bindPopup('<strong>Finish</strong><br>Back at trailhead');
                    
                    // Add waypoint markers
                    this.waypoints.forEach((wp, index) => {
                        if (index > 0 && index < this.waypoints.length - 1) {
                            L.marker([wp.lat, wp.lng])
                                .addTo(this.map)
                                .bindPopup(`<strong>${wp.name}</strong><br>${wp.description}`);
                        }
                    });
                    
                    this.map.fitBounds(this.trailPolyline.getBounds(), { padding: [50, 50] });
                    
                    this.map.addControl(new L.Control.Fullscreen());
                },
                
                initChart() {
                    const ctx = document.getElementById('elevationProfileChart');
                    if (!ctx) return;
                    
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: ['0', '1', '2', '3', '4', '5'],
                            datasets: [{
                                label: 'Elevation (m)',
                                data: [150, 180, 220, 280, 350, 420, 150],
                                borderColor: '#00A790',
                                backgroundColor: 'rgba(0, 167, 144, 0.1)',
                                fill: true,
                                tension: 0.4,
                                pointBackgroundColor: '#00A790',
                                pointRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { display: false } },
                            scales: {
                                x: { title: { display: true, text: 'Distance (km)' }, grid: { display: false } },
                                y: { title: { display: true, text: 'Elevation (m)' }, beginAtZero: true }
                            }
                        }
                    });
                },
                
                zoomIn() { this.map.zoomIn(); },
                zoomOut() { this.map.zoomOut(); },
                
                toggleFullscreen() {
                    const mapContainer = document.querySelector('.map-container');
                    if (!document.fullscreenElement) {
                        mapContainer.requestFullscreen();
                    } else {
                        document.exitFullscreen();
                    }
                },
                
                centerOnTrail() {
                    this.map.fitBounds(this.trailPolyline.getBounds(), { padding: [50, 50] });
                },
                
                flyToWaypoint(waypoint, index) {
                    this.map.flyTo([waypoint.lat, waypoint.lng], 16);
                },
                
                startNavigation() {
                    this.isNavigating = true;
                    // Simulate progress
                    let progress = 0;
                    const interval = setInterval(() => {
                        progress += 1;
                        this.progressPercent = progress;
                        this.currentDistance = (progress * this.totalDistance / 100).toFixed(1);
                        this.remainingDistance = (this.totalDistance - this.currentDistance).toFixed(1);
                        
                        if (progress >= 100) {
                            clearInterval(interval);
                            this.isNavigating = false;
                        }
                    }, 500);
                },
                
                downloadGPX() {
                    alert('GPX file download started!');
                },
                
                shareTrail() {
                    const url = window.location.href;
                    if (navigator.share) {
                        navigator.share({
                            title: 'Pine Ridge Trail',
                            text: 'Check out this amazing trail!',
                            url: url
                        });
                    } else {
                        navigator.clipboard.writeText(url);
                        alert('Link copied to clipboard!');
                    }
                }
            };
        }
    </script>
    <script src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
</body>
</html>
