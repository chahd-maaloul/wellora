{% extends 'layouts/app.html.twig' %}

{% block title %}{{ pageTitle }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block body_class %}bg-gray-50 dark:bg-gray-900{% endblock %}

{% block body %}
<div class="min-h-screen py-8">
    <div class="px-4 mx-auto max-w-7xl">
        
        {# Header #}
        <div class="flex flex-col gap-4 mb-8 lg:flex-row lg:items-center lg:justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900 lg:text-3xl dark:text-white">Health Backoffice</h1>
                <p class="mt-1 text-gray-600 dark:text-gray-400">Overview of health journals and entries</p>
            </div>
            <div class="flex items-center gap-3">
                <a href="{{ path('admin_dashboard') }}" class="inline-flex items-center px-4 py-2 text-sm font-medium text-gray-700 transition-colors bg-white border border-gray-300 rounded-lg dark:border-gray-600 dark:bg-gray-800 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700">
                    <i class="mr-2 fas fa-arrow-left"></i>Back to Dashboard
                </a>
            </div>
        </div>
        
        {# Stats Cards #}
        <div class="grid grid-cols-1 gap-4 mb-8 sm:grid-cols-2 lg:grid-cols-4">
            <div class="p-4 bg-white shadow-lg dark:bg-gray-800 rounded-xl">
                <div class="flex items-center gap-4">
                    <div class="flex items-center justify-center w-12 h-12 bg-blue-100 rounded-xl dark:bg-blue-900/30">
                        <i class="text-2xl text-blue-600 fas fa-clipboard-list"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Total Entries</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.totalEntries }}</p>
                    </div>
                </div>
                <div class="flex items-center mt-3 text-sm">
                    <span class="text-gray-500 dark:text-gray-400">All health entries recorded</span>
                </div>
            </div>
            
            <div class="p-4 bg-white shadow-lg dark:bg-gray-800 rounded-xl">
                <div class="flex items-center gap-4">
                    <div class="flex items-center justify-center w-12 h-12 bg-green-100 rounded-xl dark:bg-green-900/30">
                        <i class="text-2xl text-green-600 fas fa-book-medical"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Total Journals</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.totalJournals }}</p>
                    </div>
                </div>
                <div class="flex items-center mt-3 text-sm">
                    <span class="text-gray-500 dark:text-gray-400">Total health journals</span>
                </div>
            </div>
            
            <div class="p-4 bg-white shadow-lg dark:bg-gray-800 rounded-xl">
                <div class="flex items-center gap-4">
                    <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-amber-100 dark:bg-amber-900/30">
                        <i class="text-2xl fas fa-check-circle text-amber-600"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Active Journals</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.activeJournals }}</p>
                    </div>
                </div>
                <div class="mt-3">
                    <span class="text-sm text-green-600 dark:text-green-400">Currently active</span>
                </div>
            </div>
            
            <div class="p-4 bg-white shadow-lg dark:bg-gray-800 rounded-xl">
                <div class="flex items-center gap-4">
                    <div class="flex items-center justify-center w-12 h-12 bg-purple-100 rounded-xl dark:bg-purple-900/30">
                        <i class="text-2xl text-purple-600 fas fa-chart-line"></i>
                    </div>
                    <div>
                        <p class="text-sm text-gray-500 dark:text-gray-400">Avg Entries/Journal</p>
                        <p class="text-2xl font-bold text-gray-900 dark:text-white">{{ stats.avgEntriesPerJournal }}</p>
                    </div>
                </div>
                <div class="flex items-center mt-3 text-sm">
                    <span class="text-gray-500 dark:text-gray-400">Average per journal</span>
                </div>
            </div>
        </div>
        
        {# Journals Table #}
        <div class="mb-8 overflow-hidden bg-white shadow-lg dark:bg-gray-800 rounded-xl">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Health Journals</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400">All health journals with entry counts</p>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 dark:bg-gray-900">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Journal Name</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Start Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">End Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Entries</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Status</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        {% for journal in journals %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">{{ journal.id }}</td>
                            <td class="px-4 py-3 text-sm font-medium text-gray-900 dark:text-white">{{ journal.name }}</td>
                            <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">{{ journal.dateDebut }}</td>
                            <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">{{ journal.dateFin }}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400">
                                    {{ journal.entryCount }} entries
                                </span>
                            </td>
                            <td class="px-4 py-3 text-sm">
                                {% if journal.status == 'Active' %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400">
                                    Active
                                </span>
                                {% else %}
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400">
                                    Closed
                                </span>
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                No health journals found.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
        {# Recent Entries #}
        <div class="overflow-hidden bg-white shadow-lg dark:bg-gray-800 rounded-xl">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <h2 class="text-lg font-semibold text-gray-900 dark:text-white">Recent Health Entries</h2>
                <p class="text-sm text-gray-500 dark:text-gray-400">Latest recorded health entries</p>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-50 dark:bg-gray-900">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">ID</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Date</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Journal</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Glycemia</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Blood Pressure</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider">Weight</th>
                        </tr>
                    </thead>
                    <tbody class="divide-y divide-gray-200 dark:divide-gray-700">
                        {% for entry in recentEntries %}
                        <tr class="hover:bg-gray-50 dark:hover:bg-gray-700/50">
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">{{ entry.id }}</td>
                            <td class="px-4 py-3 text-sm text-gray-500 dark:text-gray-400">{{ entry.date }}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">{{ entry.journalName }}</td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">
                                {% if entry.glycemie %}
                                <span class="text-green-600 dark:text-green-400">{{ entry.glycemie }} g/L</span>
                                {% else %}
                                <span class="text-gray-400">-</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">
                                {% if entry.tension %}
                                {{ entry.tension }}
                                {% else %}
                                <span class="text-gray-400">-</span>
                                {% endif %}
                            </td>
                            <td class="px-4 py-3 text-sm text-gray-900 dark:text-white">
                                {% if entry.poids %}
                                <span class="text-blue-600 dark:text-blue-400">{{ entry.poids }} kg</span>
                                {% else %}
                                <span class="text-gray-400">-</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% else %}
                        <tr>
                            <td colspan="6" class="px-4 py-8 text-center text-gray-500 dark:text-gray-400">
                                No health entries found.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
        
    </div>
</div>
{% endblock %}
